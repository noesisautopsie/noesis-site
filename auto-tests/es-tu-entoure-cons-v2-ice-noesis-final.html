<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- SEO -->
  <title>Es-tu entouré·e de cons ? v2 — Indice de Connerie Environnementale (ICE) | NOÉSIS</title>
  <meta name="description" content="Auto-test psychosocial (42 questions) pour mesurer l'Indice de Connerie Environnementale. Analyse scientifique et humoristique de votre entourage social, professionnel et familial.">
  
  <!-- Open Graph -->
  <meta property="og:title" content="Es-tu entouré·e de cons ? v2 — ICE | NOÉSIS">
  <meta property="og:description" content="Test ICE 42 questions. Analyse scientifique et humoristique de votre environnement relationnel.">
  <meta property="og:type" content="website">
  
  <!-- Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- React + ReactDOM via CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- Babel Standalone pour JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <style>
    /* Styles d'impression PDF optimisés A4 */
    @media print {
      .no-print { display: none !important; }
      .print-only { display: block !important; }
      
      body { 
        background: white !important;
        margin: 0;
        padding: 0;
      }
      
      @page {
        size: A4;
        margin: 12mm 15mm;
      }
      
      .print-container {
        max-width: 100%;
        padding: 0 !important;
        margin: 0 !important;
      }
      
      .print-section {
        padding: 8px 0 !important;
        margin-bottom: 12px !important;
      }
      
      .print-header {
        font-size: 18px !important;
        margin-bottom: 8px !important;
        padding-bottom: 4px !important;
        border-bottom: 2px solid #334155;
      }
      
      .print-subheader {
        font-size: 14px !important;
        margin: 8px 0 4px 0 !important;
      }
      
      .print-text {
        font-size: 11px !important;
        line-height: 1.4 !important;
        margin: 2px 0 !important;
      }
      
      .print-question {
        font-size: 11px !important;
        padding: 3px 0 !important;
        page-break-inside: avoid;
      }
      
      .print-axis-section {
        page-break-inside: avoid;
        margin-bottom: 10px !important;
      }
      
      .print-score-box {
        padding: 6px !important;
        margin: 4px 0 !important;
        border: 1px solid #e2e8f0;
        border-radius: 4px;
      }
      
      .print-reco {
        font-size: 11px !important;
        padding: 2px 0 2px 16px !important;
        margin: 2px 0 !important;
      }
    }
    
    .print-only {
      display: none;
    }
  </style>
</head>
<body class="m-0 p-0">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useMemo, useCallback } = React;

    // ============================================================
    // CONFIGURATION
    // ============================================================

    const DIMENSIONS = [
      { 
        key: "irritants", 
        label: "Irritants sociaux", 
        color: "amber",
        description: "Interruptions constantes, désaccords obstinés, commentaires rabaissants."
      },
      { 
        key: "culpa", 
        label: "Maîtres de la culpabilité", 
        color: "orange",
        description: "Manipulation par la dette morale, invalidation de vos besoins, victimisation."
      },
      { 
        key: "manip", 
        label: "Manipulateurs subtils", 
        color: "fuchsia",
        description: "Réécriture de l'histoire, fausses promesses, silence punitif."
      },
      { 
        key: "ego", 
        label: "Égo-centrifuges", 
        color: "sky",
        description: "Vampirisation de l'attention, absence de réciprocité, appropriation des mérites."
      },
      { 
        key: "chaos", 
        label: "Agents du chaos", 
        color: "indigo",
        description: "Urgences fabriquées, instabilité émotionnelle, conflits chroniques."
      },
      { 
        key: "limites", 
        label: "Testeurs de limites", 
        color: "violet",
        description: "Non-respect des frontières, intrusion, chantage affectif."
      },
      { 
        key: "protect", 
        label: "Facteurs protecteurs", 
        color: "emerald",
        description: "Capacité à dire non, filtrage relationnel, soutien social, documentation des faits."
      }
    ];

    const CHOICES = [
      { value: 0, label: "Jamais", anchor: "0 fois / 6 mois" },
      { value: 1, label: "Parfois", anchor: "1–3× / mois" },
      { value: 2, label: "Souvent", anchor: "1–3× / semaine" },
      { value: 3, label: "Très souvent", anchor: "Quasi quotidien" }
    ];

    const QUESTIONS = [
      // A — Irritants sociaux (6)
      {id:"Q1", dim:"irritants", text:"Coupe la parole / termine mes phrases 'pour m'aider'."},
      {id:"Q2", dim:"irritants", text:"Exige d'avoir raison, même face à l'évidence."},
      {id:"Q3", dim:"irritants", text:"Transforme une discussion en concours d'ego."},
      {id:"Q4", dim:"irritants", text:"Fait des remarques rabaissantes 'pour plaisanter'."},
      {id:"Q5", dim:"irritants", text:"Critique en public des détails sans importance."},
      {id:"Q6", dim:"irritants", text:"Refuse de s'excuser / change de sujet quand pris en défaut."},
      
      // B — Maîtres de la culpabilité (6)
      {id:"Q7", dim:"culpa", text:"Me fait culpabiliser quand je pose un 'non' simple."},
      {id:"Q8", dim:"culpa", text:"Utilise la dette morale : 'après tout ce que j'ai fait'."},
      {id:"Q9", dim:"culpa", text:"Prétend être blessé pour éviter une discussion de fond."},
      {id:"Q10", dim:"culpa", text:"Minimise mes besoins : 'tu dramatises' / 'tu es sensible'."},
      {id:"Q11", dim:"culpa", text:"Me met en scène comme l'égoïste si j'ai d'autres priorités."},
      {id:"Q12", dim:"culpa", text:"Transforme mes succès en reproches implicites."},
      
      // C — Manipulateurs subtils (6)
      {id:"Q13", dim:"manip", text:"Réécrit l'histoire ('je n'ai jamais dit ça')."},
      {id:"Q14", dim:"manip", text:"Associe excuses et promesses… sans changement réel."},
      {id:"Q15", dim:"manip", text:"Utilise le silence punitif / délais anormaux pour me faire céder."},
      {id:"Q16", dim:"manip", text:"Me teste (jalousie, loyauté) avec pièges émotionnels."},
      {id:"Q17", dim:"manip", text:"Change les règles après coup à son avantage."},
      {id:"Q18", dim:"manip", text:"Relaye des rumeurs ou info tronquée pour me déstabiliser."},
      
      // D — Égo-centrifuges (6)
      {id:"Q19", dim:"ego", text:"Recentre toute conversation sur lui/elle rapidement."},
      {id:"Q20", dim:"ego", text:"Demande mon aide mais disparaît pour la réciprocité."},
      {id:"Q21", dim:"ego", text:"S'approprie mes idées / mon travail."},
      {id:"Q22", dim:"ego", text:"Attend disponibilité immédiate, quel que soit mon contexte."},
      {id:"Q23", dim:"ego", text:"S'auto-met en scène comme victime dès que je pose une limite."},
      {id:"Q24", dim:"ego", text:"Valorise son image plutôt que la relation réelle."},
      
      // E — Agents du chaos (6)
      {id:"Q25", dim:"chaos", text:"Crée des urgences évitables que je dois régler."},
      {id:"Q26", dim:"chaos", text:"Passe de l'adoration au dénigrement en quelques heures."},
      {id:"Q27", dim:"chaos", text:"Conflits récurrents pour des broutilles."},
      {id:"Q28", dim:"chaos", text:"Demande des changements de dernière minute chroniques."},
      {id:"Q29", dim:"chaos", text:"Met les gens en compétition / entretient les clans."},
      {id:"Q30", dim:"chaos", text:"Me laisse épuisé·e/confus·e après échanges."},
      
      // F — Testeurs de limites (6)
      {id:"Q31", dim:"limites", text:"Insiste après un 'non', tente encore 'juste un petit peu'."},
      {id:"Q32", dim:"limites", text:"Contacte à des horaires canons (tard/tôt) malgré mes règles."},
      {id:"Q33", dim:"limites", text:"Partage mes infos privées sans mon accord."},
      {id:"Q34", dim:"limites", text:"Ridiculise mes valeurs / besoins pour obtenir gain de cause."},
      {id:"Q35", dim:"limites", text:"Fait du chantage affectif / menace voilée si je refuse."},
      {id:"Q36", dim:"limites", text:"Teste régulièrement jusqu'où ça passe avant que je réagisse."},
      
      // G — Facteurs protecteurs (6)
      {id:"Q37", dim:"protect", text:"Je sais dire non simplement et m'y tenir."},
      {id:"Q38", dim:"protect", text:"Je filtre l'accès (temps/canaux) aux personnes drainantes."},
      {id:"Q39", dim:"protect", text:"Je privilégie les relations réciproques et prévisibles."},
      {id:"Q40", dim:"protect", text:"Je demande du soutien (ami, collègue, pro) quand c'est lourd."},
      {id:"Q41", dim:"protect", text:"Je documente les faits importants par écrit (date, contenu)."},
      {id:"Q42", dim:"protect", text:"Je prends soin de mon énergie (sommeil, pauses, activité)."},
    ];

    const MAX_DRAIN = 18 * 6; // 108
    const MAX_PROTECT = 18; // 18
    const MAX_ICE = 126; // drain + (18 - protect)

    // ============================================================
    // FONCTIONS CALCUL & INTERPRÉTATION
    // ============================================================

    function getInterpretation(ice) {
      if (ice <= 30) {
        return {
          band: "Faible",
          color: "green",
          severity: "none",
          message: "Environnement relationnel soutenant. Les interactions restent équilibrées et les relations sont majoritairement réciproques. Votre capacité à poser des limites est préservée.",
          fun: "Tu vis dans un jardin zen (ou t'es un moine tibétain).",
          recommendations: [
            "Maintenir vos pratiques actuelles de régulation relationnelle.",
            "Continuer à cultiver les relations saines et réciproques.",
            "Rester vigilant sur l'équilibre donner/recevoir dans les nouvelles relations.",
            "Préserver vos routines protectrices (sommeil, filtres, soutien social)."
          ]
        };
      }
      
      if (ice <= 60) {
        return {
          band: "Modéré",
          color: "yellow",
          severity: "low",
          message: "Pression sociale normale avec maintien du contrôle. Quelques comportements drainants sont présents mais vous gérez globalement les situations. Votre capacité d'esquive est préservée.",
          fun: "Quelques boulets orbitent, mais tu esquives bien.",
          recommendations: [
            "Identifier les sources principales de drainage : qui, quand, comment ?",
            "Renforcer les stratégies de filtrage : canaux, horaires, durée des échanges.",
            "Pratiquer la technique du 'non simple' sans justification excessive.",
            "Documenter factuellement les interactions problématiques récurrentes.",
            "Maintenir les espaces de récupération (pauses, nature, activités hors contexte drainant)."
          ]
        };
      }
      
      if (ice <= 90) {
        return {
          band: "Élevé",
          color: "orange",
          severity: "moderate",
          message: "Fatigue cognitive et relationnelle probable. L'exposition aux comportements drainants devient chronique et impacte votre énergie quotidienne. Votre radar à cons est en suractivation.",
          fun: "Ton radar à cons clignote rouge. Trop d'exposition.",
          recommendations: [
            "PRIORITÉ : Réduire l'exposition aux personnes les plus drainantes (temps, fréquence, canaux).",
            "Établir des règles relationnelles explicites : horaires, canaux, temps de réponse.",
            "Utiliser le 'disque rayé' : répéter le même message sans varier.",
            "Documenter systématiquement les faits problématiques (date, contenu, témoin si possible).",
            "Renforcer le bouclier protecteur : alliés de confiance, humour, recul analytique.",
            "Consulter un thérapeute spécialisé en dynamiques relationnelles si besoin.",
            "Restaurer les fondamentaux : sommeil, alimentation, activité physique, respiration."
          ]
        };
      }
      
      return {
        band: "Critique",
        color: "red",
        severity: "critical",
        message: "Risque élevé d'épuisement ou d'emprise relationnelle. L'environnement social, professionnel ou familial présente une densité critique de comportements toxiques. Votre système nerveux est en hypervigilance chronique.",
        fun: "Ton entourage est un zoo social. Sauve-toi (ou observe pour la science).",
        recommendations: [
          "URGENCE : Évaluer la possibilité de mettre à distance physique ou relationnelle les personnes les plus toxiques.",
          "Consulter un psychologue spécialisé en dynamiques d'emprise et manipulation.",
          "Si contexte professionnel : contacter médecine du travail, CHSCT, inspection du travail selon situation.",
          "Si contexte familial : activer réseau de soutien extérieur, envisager accompagnement spécialisé violences psychologiques.",
          "Documenter exhaustivement les faits : dates, contenus, témoins, preuves écrites.",
          "Mettre en place un 'plan de sécurité relationnelle' : alliés, lieux refuges, stratégies de sortie.",
          "Restaurer prioritairement les fonctions physiologiques : sommeil, alimentation, activité physique supervisée.",
          "Pratiquer quotidiennement des techniques de régulation : cohérence cardiaque, respiration, mindfulness.",
          "Si détresse aiguë : 3114 (prévention suicide), urgences 15 ou 112."
        ]
      };
    }

    function getAxisAnalysis(key, val) {
      const lvl = val <= 6 ? 'low' : val <= 12 ? 'medium' : 'high';
      
      const tips = {
        irritants: {
          low: ["Rien à signaler, continue le débat fair-play."],
          medium: ["Fixe le tour de parole. Reformule, recentre."],
          high: ["Raccourcis : « Je te laisse finir, puis je réponds. »"]
        },
        culpa: {
          low: ["Tu sais poser un non propre."],
          medium: ["Remplace « désolé » par « non, ce n'est pas possible »."],
          high: ["Réponse type : « Je comprends que tu sois déçu, et ma réponse reste non. »"]
        },
        manip: {
          low: ["Réalité stable."],
          medium: ["Demande des écrits pour éviter la réécriture."],
          high: ["Rédige un mémo après les échanges (date, faits, décisions)."]
        },
        ego: {
          low: ["Réciprocité OK."],
          medium: ["Calcule ton ratio donner/recevoir. Ajuste."],
          high: ["Pack « limites » : délai de réponse + refuser la disponibilité immédiate."]
        },
        chaos: {
          low: ["Rythme sain."],
          medium: ["Bloque des créneaux calmes. Pas d'urgence fabriquée."],
          high: ["Standardise : « Prochaine fenêtre dispo : jeudi 14h. »"]
        },
        limites: {
          low: ["Frontières nettes."],
          medium: ["Formule tes règles : canaux/horaires."],
          high: ["Non + disque rayé. Change de canal si besoin."]
        },
        protect: {
          low: ["Renforce tes boucliers (sommeil, filtres, alliés)."],
          medium: ["Tu progresses : conserve le journal des faits."],
          high: ["Top : maintiens tes routines protectrices."]
        }
      };
      
      const humor = {
        irritants: "Ces gens pensent que leur clavier interne est plus rapide que ta bouche.",
        culpa: "Ils ont un doctorat en manipulation affective, option 'martyr professionnel'.",
        manip: "Gaslighting artisanal, fabriqué à la main depuis 1850.",
        ego: "Trou noir relationnel : tout tourne autour d'eux, rien n'en ressort.",
        chaos: "Leur énergie ? Un ouragan sur pattes. Ta sérénité ? Leur ennemi.",
        limites: "Ils testent tes limites comme un enfant teste la patience d'un parent zen.",
        protect: "Tes boucliers psychologiques déterminent ton niveau de survie sociale."
      };
      
      return {
        lvl,
        tips: tips[key][lvl],
        humor: humor[key]
      };
    }

    // ============================================================
    // COMPOSANT PRINCIPAL
    // ============================================================

    function ICETest() {
      const [page, setPage] = useState("intro");
      const [currentQ, setCurrentQ] = useState(0);
      const [answers, setAnswers] = useState({});
      const [email, setEmail] = useState("");

      // SUPPRESSION TOTALE localStorage — Test toujours vierge

      const allAnswered = Object.keys(answers).length === QUESTIONS.length;

      const handleAnswer = useCallback((qId, value) => {
        setAnswers(prev => ({ ...prev, [qId]: value }));
        
        if (currentQ < QUESTIONS.length - 1) {
          setTimeout(() => setCurrentQ(c => c + 1), 150);
        }
      }, [currentQ]);

      const goToResults = useCallback(() => {
        if (!allAnswered) {
          alert(`Il reste ${QUESTIONS.length - Object.keys(answers).length} question(s) sans réponse.`);
          return;
        }
        setPage("results");
      }, [allAnswered, answers]);

      const reset = useCallback(() => {
        setAnswers({});
        setCurrentQ(0);
        setPage("intro");
        setEmail("");
      }, []);

      const dimensionScores = useMemo(() => {
        const scores = {};
        DIMENSIONS.forEach(dim => {
          const qs = QUESTIONS.filter(q => q.dim === dim.key);
          const total = qs.reduce((sum, q) => sum + (answers[q.id] || 0), 0);
          scores[dim.key] = total;
        });
        return scores;
      }, [answers]);

      const totalICE = useMemo(() => {
        const drainKeys = ['irritants', 'culpa', 'manip', 'ego', 'chaos', 'limites'];
        const totalDrain = drainKeys.reduce((sum, k) => sum + dimensionScores[k], 0);
        const totalProtect = dimensionScores.protect || 0;
        return totalDrain + (MAX_PROTECT - totalProtect);
      }, [dimensionScores]);

      const ISR = useMemo(() => {
        const drainKeys = ['irritants', 'culpa', 'manip', 'ego', 'chaos', 'limites'];
        const totalDrain = drainKeys.reduce((sum, k) => sum + dimensionScores[k], 0);
        return (totalDrain / drainKeys.length).toFixed(1);
      }, [dimensionScores]);

      const resultBand = useMemo(() => getInterpretation(totalICE), [totalICE]);

      const handlePDF = useCallback(() => {
        window.print();
      }, []);

      const handleDownloadJSON = useCallback(() => {
        const data = {
          test: "Es-tu entouré·e de cons ? v2 — ICE",
          date: new Date().toISOString(),
          totalICE,
          ISR,
          dimensionScores,
          resultBand,
          answers
        };
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `noesis-ice-${new Date().toISOString().split('T')[0]}.json`;
        a.click();
      }, [totalICE, ISR, dimensionScores, resultBand, answers]);

      const handleEmail = useCallback(() => {
        if (!email) return;
        const subject = encodeURIComponent("Résultats Auto-test ICE");
        const body = encodeURIComponent(
          `Bonjour,\n\nVoici mes résultats au test ICE NOÉSIS :\n\n` +
          `Score ICE : ${totalICE}/126\n` +
          `ISR : ${ISR}\n` +
          `Profil : ${resultBand.band}\n\n` +
          `Pour consulter le détail complet, merci de télécharger le PDF ou JSON depuis le site.`
        );
        window.location.href = `mailto:${email}?subject=${subject}&body=${body}`;
      }, [email, totalICE, ISR, resultBand]);

      const progress = useMemo(() => Math.round((currentQ / QUESTIONS.length) * 100), [currentQ]);

      // ============================================================
      // PAGE INTRO
      // ============================================================

      if (page === "intro") {
        return (
          <div className="min-h-screen bg-gradient-to-br from-slate-50 via-indigo-50 to-purple-50 p-4 md:p-8">
            <div className="max-w-3xl mx-auto">
              <div className="text-center mb-8">
                <div className="inline-block p-4 bg-indigo-100 rounded-2xl mb-4">
                  <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="text-indigo-600">
                    <path d="M9.5 2c-1.82 0-3.53.5-5 1.36C2.68 4.72 1.5 6.73 1.5 9c0 1.56.52 3 1.39 4.14.87 1.14 2.07 2 3.43 2.36"/>
                    <path d="M14.5 2c1.82 0 3.53.5 5 1.36C21.32 4.72 22.5 6.73 22.5 9c0 1.56-.52 3-1.39 4.14-.87 1.14-2.07 2-3.43 2.36"/>
                    <path d="M12 2v20"/>
                    <path d="M9.5 15.5c0 1.38.62 2.5 1.5 2.5"/>
                    <path d="M14.5 15.5c0 1.38-.62 2.5-1.5 2.5"/>
                    <circle cx="9" cy="9" r="1" fill="currentColor"/>
                    <circle cx="15" cy="9" r="1" fill="currentColor"/>
                  </svg>
                </div>
                <h1 className="text-4xl md:text-5xl font-black text-slate-900 mb-3">
                  Es-tu entouré·e de cons ? v2
                </h1>
                <p className="text-lg text-slate-600 font-medium">
                  Indice de Connerie Environnementale (ICE)
                </p>
              </div>

              <div className="bg-white rounded-2xl shadow-2xl p-6 md:p-8 mb-6">
                <div className="bg-amber-50 border-l-4 border-amber-500 p-4 mb-6 rounded-r-lg">
                  <div className="flex gap-3">
                    <span className="text-2xl flex-shrink-0">⚠️</span>
                    <div className="text-sm text-amber-900">
                      <p className="font-bold mb-1">Avertissement méthodologique</p>
                      <p className="leading-relaxed">
                        Cet outil de <strong>psycho-éducation relationnelle</strong> repose sur la psychologie sociale, 
                        la clinique de l'emprise et les neurosciences du stress. Il mesure des <strong>patterns 
                        comportementaux</strong>, pas la valeur des personnes. Ce n'est <strong>ni un diagnostic</strong>, 
                        ni une expertise juridique. Si détresse aiguë : <strong>3114 (FR)</strong>, urgences 15 ou 112.
                      </p>
                    </div>
                  </div>
                </div>

                <div className="mb-8">
                  <div className="flex items-center gap-2 mb-4">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="text-slate-700">
                      <circle cx="11" cy="11" r="8"/>
                      <path d="m21 21-4.35-4.35"/>
                      <circle cx="11" cy="11" r="3"/>
                    </svg>
                    <h2 className="text-xl font-bold text-slate-900">Méthodologie</h2>
                  </div>
                  <div className="grid grid-cols-2 md:grid-cols-4 gap-3 mb-6">
                    <div className="bg-amber-50 text-amber-700 px-3 py-2 rounded-lg text-center text-sm font-semibold">
                      Irritants sociaux
                    </div>
                    <div className="bg-orange-50 text-orange-700 px-3 py-2 rounded-lg text-center text-sm font-semibold">
                      Culpabilisateurs
                    </div>
                    <div className="bg-fuchsia-50 text-fuchsia-700 px-3 py-2 rounded-lg text-center text-sm font-semibold">
                      Manipulateurs
                    </div>
                    <div className="bg-sky-50 text-sky-700 px-3 py-2 rounded-lg text-center text-sm font-semibold">
                      Égo-centrifuges
                    </div>
                    <div className="bg-indigo-50 text-indigo-700 px-3 py-2 rounded-lg text-center text-sm font-semibold">
                      Agents chaos
                    </div>
                    <div className="bg-violet-50 text-violet-700 px-3 py-2 rounded-lg text-center text-sm font-semibold">
                      Testeurs limites
                    </div>
                    <div className="bg-emerald-50 text-emerald-700 px-3 py-2 rounded-lg text-center text-sm font-semibold col-span-2">
                      Facteurs protecteurs
                    </div>
                  </div>

                  <div className="prose prose-sm text-slate-700 space-y-3">
                    <p className="leading-relaxed">
                      Test basé sur <strong>7 axes comportementaux</strong> (6 drainants + 1 protecteur), 
                      42 questions, échelle Likert 4 points, période de référence : <strong>6 derniers mois</strong>. 
                      Le score ICE combine le drainage relationnel et la capacité de protection.
                    </p>
                  </div>
                </div>

                <div className="grid md:grid-cols-3 gap-4 mb-8">
                  <div className="bg-slate-50 p-4 rounded-xl text-center">
                    <div className="flex justify-center mb-2">
                      <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="text-indigo-600">
                        <circle cx="12" cy="13" r="9"/>
                        <polyline points="12 7 12 13 15 15"/>
                        <path d="M10 2h4"/>
                      </svg>
                    </div>
                    <div className="text-2xl font-bold text-slate-900">13-16 min</div>
                    <div className="text-sm text-slate-600">Durée estimée</div>
                  </div>
                  <div className="bg-slate-50 p-4 rounded-xl text-center">
                    <div className="flex justify-center mb-2">
                      <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="text-indigo-600">
                        <line x1="18" y1="20" x2="18" y2="10"/>
                        <line x1="12" y1="20" x2="12" y2="4"/>
                        <line x1="6" y1="20" x2="6" y2="14"/>
                      </svg>
                    </div>
                    <div className="text-2xl font-bold text-slate-900">42 questions</div>
                    <div className="text-sm text-slate-600">Questionnaire ICE</div>
                  </div>
                  <div className="bg-slate-50 p-4 rounded-xl text-center">
                    <div className="flex justify-center mb-2">
                      <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="text-indigo-600">
                        <path d="M3 3v18h18"/>
                        <path d="M18 9l-5 5-4-4-4 4"/>
                        <circle cx="18" cy="9" r="2" fill="currentColor"/>
                        <circle cx="13" cy="14" r="2" fill="currentColor"/>
                        <circle cx="9" cy="10" r="2" fill="currentColor"/>
                        <circle cx="5" cy="14" r="2" fill="currentColor"/>
                      </svg>
                    </div>
                    <div className="text-2xl font-bold text-slate-900">7 dimensions</div>
                    <div className="text-sm text-slate-600">Analyse multi-axes</div>
                  </div>
                </div>

                <button
                  onClick={() => setPage("test")}
                  className="w-full bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white text-lg font-bold py-4 px-6 rounded-xl transition-all shadow-lg hover:shadow-xl"
                >
                  Commencer le test →
                </button>
              </div>

              <div className="text-center text-xs text-slate-500 space-y-1">
                <p className="font-semibold">NOÉSIS — « Es-tu entouré·e de cons ? » v2 • © 2025</p>
                <p>Confidentialité : aucune donnée collectée sans action explicite (RGPD)</p>
              </div>
            </div>
          </div>
        );
      }

      // ============================================================
      // PAGE TEST
      // ============================================================

      if (page === "test") {
        const q = QUESTIONS[currentQ];
        const dimInfo = DIMENSIONS.find(d => d.key === q.dim);
        const colorMap = {
          amber: { bg: "bg-amber-50", border: "border-amber-300", text: "text-amber-700", badge: "bg-amber-100 text-amber-700" },
          orange: { bg: "bg-orange-50", border: "border-orange-300", text: "text-orange-700", badge: "bg-orange-100 text-orange-700" },
          fuchsia: { bg: "bg-fuchsia-50", border: "border-fuchsia-300", text: "text-fuchsia-700", badge: "bg-fuchsia-100 text-fuchsia-700" },
          sky: { bg: "bg-sky-50", border: "border-sky-300", text: "text-sky-700", badge: "bg-sky-100 text-sky-700" },
          indigo: { bg: "bg-indigo-50", border: "border-indigo-300", text: "text-indigo-700", badge: "bg-indigo-100 text-indigo-700" },
          violet: { bg: "bg-violet-50", border: "border-violet-300", text: "text-violet-700", badge: "bg-violet-100 text-violet-700" },
          emerald: { bg: "bg-emerald-50", border: "border-emerald-300", text: "text-emerald-700", badge: "bg-emerald-100 text-emerald-700" },
        };
        const colors = colorMap[dimInfo.color];

        return (
          <div className="min-h-screen bg-gradient-to-br from-slate-50 via-indigo-50 to-purple-50 p-4 md:p-8">
            <div className="max-w-3xl mx-auto">
              
              <div className="mb-6">
                <div className="flex justify-between items-center mb-2">
                  <span className="text-sm font-medium text-slate-600">
                    Question {currentQ + 1} / {QUESTIONS.length}
                  </span>
                  <span className="text-sm font-medium text-slate-600">
                    {progress}%
                  </span>
                </div>
                <div className="w-full bg-slate-200 rounded-full h-2">
                  <div
                    className="bg-gradient-to-r from-indigo-600 to-purple-600 h-2 rounded-full transition-all duration-300"
                    style={{ width: `${progress}%` }}
                  ></div>
                </div>
              </div>

              <div className={`${colors.bg} border-2 ${colors.border} rounded-2xl p-6 md:p-8 mb-6`}>
                <div className={`inline-block px-3 py-1 rounded-full text-xs font-bold mb-4 ${colors.badge}`}>
                  {dimInfo.label}
                </div>
                
                <div className="flex items-start gap-4 mb-6">
                  <div className={`flex-shrink-0 w-10 h-10 rounded-full bg-slate-900 text-white flex items-center justify-center font-bold`}>
                    {currentQ + 1}
                  </div>
                  <p className="text-lg md:text-xl text-slate-900 leading-relaxed font-medium">
                    {q.text}
                  </p>
                </div>

                <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
                  {CHOICES.map(choice => {
                    const selected = answers[q.id] === choice.value;
                    return (
                      <button
                        key={choice.value}
                        onClick={() => handleAnswer(q.id, choice.value)}
                        className={`
                          p-4 rounded-xl border-2 transition-all font-medium
                          ${selected 
                            ? 'bg-slate-900 border-slate-900 text-white shadow-lg scale-105' 
                            : 'bg-white border-slate-200 text-slate-700 hover:border-slate-400 hover:shadow'
                          }
                        `}
                      >
                        <div className="font-bold text-sm mb-1">{choice.label}</div>
                        <div className="text-xs opacity-75">{choice.anchor}</div>
                      </button>
                    );
                  })}
                </div>
              </div>

              <div className="flex justify-between items-center gap-4">
                <button
                  onClick={() => setCurrentQ(c => c - 1)}
                  disabled={currentQ === 0}
                  className="px-6 py-3 rounded-xl bg-white border-2 border-slate-300 text-slate-700 font-semibold hover:bg-slate-50 disabled:opacity-30 disabled:cursor-not-allowed transition-all"
                >
                  ← Précédent
                </button>
                <button
                  onClick={() => {
                    if (currentQ === QUESTIONS.length - 1) {
                      goToResults();
                    } else {
                      setCurrentQ(c => c + 1);
                    }
                  }}
                  className="px-6 py-3 rounded-xl bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-semibold transition-all shadow-lg"
                >
                  {currentQ === QUESTIONS.length - 1 ? 'Voir résultats →' : 'Suivant →'}
                </button>
              </div>
            </div>
          </div>
        );
      }

      // ============================================================
      // PAGE RÉSULTATS
      // ============================================================

      if (page === "results") {
        const badgeColorMap = {
          green: "bg-green-100 text-green-800 border-green-300",
          yellow: "bg-yellow-100 text-yellow-800 border-yellow-300",
          orange: "bg-orange-100 text-orange-800 border-orange-300",
          red: "bg-red-100 text-red-800 border-red-300"
        };

        return (
          <div className="min-h-screen bg-gradient-to-br from-slate-50 via-indigo-50 to-purple-50 p-4 md:p-8">
            <div className="max-w-5xl mx-auto">
              
              {/* SECTION VISIBLE À L'ÉCRAN */}
              <div className="no-print space-y-6">
                <div className="text-center mb-8">
                  <div className="inline-block p-4 bg-indigo-100 rounded-2xl mb-4">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="text-indigo-600">
                      <path d="M3 3v18h18"/>
                      <path d="M18 9l-5 5-4-4-4 4"/>
                      <circle cx="18" cy="9" r="2" fill="currentColor"/>
                      <circle cx="13" cy="14" r="2" fill="currentColor"/>
                      <circle cx="9" cy="10" r="2" fill="currentColor"/>
                      <circle cx="5" cy="14" r="2" fill="currentColor"/>
                    </svg>
                  </div>
                  <h1 className="text-4xl md:text-5xl font-black text-slate-900 mb-3">
                    Votre Profil ICE
                  </h1>
                  <p className="text-lg text-slate-600 font-medium">
                    Indice de Connerie Environnementale
                  </p>
                </div>

                <div className="bg-white rounded-2xl shadow-2xl p-6 md:p-8">
                  <div className="text-center mb-8">
                    <div className="text-7xl md:text-8xl font-black text-slate-900 mb-3">
                      {totalICE}
                      <span className="text-3xl md:text-4xl text-slate-500 ml-2">/126</span>
                    </div>
                    <div className={`inline-block px-6 py-2 rounded-full text-xl font-bold border-2 ${badgeColorMap[resultBand.color]} mb-4`}>
                      {resultBand.band}
                    </div>
                    <p className="text-slate-700 leading-relaxed max-w-2xl mx-auto mb-2">
                      {resultBand.message}
                    </p>
                    <p className="text-slate-600 italic">
                      {resultBand.fun}
                    </p>
                  </div>

                  <div className="grid md:grid-cols-2 gap-4 mb-8">
                    <div className="bg-slate-50 p-4 rounded-xl text-center">
                      <div className="text-xs text-slate-600 mb-1">ISR — Indice Saturation Relationnelle</div>
                      <div className="text-3xl font-bold text-slate-900">{ISR}/18</div>
                    </div>
                    <div className="bg-slate-50 p-4 rounded-xl text-center">
                      <div className="text-xs text-slate-600 mb-1">Facteurs protecteurs</div>
                      <div className="text-3xl font-bold text-slate-900">{dimensionScores.protect}/18</div>
                    </div>
                  </div>

                  <div className="space-y-4 mb-8">
                    <h2 className="text-2xl font-bold text-slate-900">Scores par dimension</h2>
                    {DIMENSIONS.map(dim => {
                      const score = dimensionScores[dim.key];
                      const max = 18;
                      const percentage = Math.round((score / max) * 100);
                      const analysis = getAxisAnalysis(dim.key, score);
                      
                      const colorMap = {
                        amber: { bg: "bg-amber-50", bar: "bg-amber-500", text: "text-amber-700" },
                        orange: { bg: "bg-orange-50", bar: "bg-orange-500", text: "text-orange-700" },
                        fuchsia: { bg: "bg-fuchsia-50", bar: "bg-fuchsia-500", text: "text-fuchsia-700" },
                        sky: { bg: "bg-sky-50", bar: "bg-sky-500", text: "text-sky-700" },
                        indigo: { bg: "bg-indigo-50", bar: "bg-indigo-500", text: "text-indigo-700" },
                        violet: { bg: "bg-violet-50", bar: "bg-violet-500", text: "text-violet-700" },
                        emerald: { bg: "bg-emerald-50", bar: "bg-emerald-500", text: "text-emerald-700" },
                      };
                      const colors = colorMap[dim.color];
                      
                      return (
                        <div key={dim.key} className={`${colors.bg} p-5 rounded-xl`}>
                          <div className="flex justify-between items-center mb-3">
                            <span className={`font-bold ${colors.text}`}>{dim.label}</span>
                            <span className="text-slate-700 font-bold">{score}/{max}</span>
                          </div>
                          <div className="w-full bg-white rounded-full h-3 overflow-hidden mb-3">
                            <div 
                              className={`${colors.bar} h-full transition-all duration-500 rounded-full`}
                              style={{ width: `${percentage}%` }}
                            />
                          </div>
                          <p className="text-xs text-slate-600 mb-2">{dim.description}</p>
                          <p className="text-xs text-slate-600 italic mb-2">{analysis.humor}</p>
                          <ul className="text-xs text-slate-700 space-y-1">
                            {analysis.tips.map((tip, i) => (
                              <li key={i}>• {tip}</li>
                            ))}
                          </ul>
                        </div>
                      );
                    })}
                  </div>
                </div>

                <div className="grid md:grid-cols-2 gap-6">
                  <div className="bg-white rounded-2xl shadow-xl p-6">
                    <h2 className="text-2xl font-bold text-slate-900 mb-4">Recommandations</h2>
                    <ul className="space-y-3">
                      {resultBand.recommendations.map((rec, idx) => (
                        <li key={idx} className="flex gap-3 text-sm text-slate-700">
                          <span className="flex-shrink-0 w-6 h-6 rounded-full bg-indigo-100 text-indigo-600 font-bold text-xs flex items-center justify-center">
                            {idx + 1}
                          </span>
                          <span>{rec}</span>
                        </li>
                      ))}
                    </ul>

                    <div className="mt-6 pt-6 border-t-2 border-slate-100">
                      <h3 className="font-bold text-slate-900 mb-3">Ressources utiles</h3>
                      <ul className="space-y-2 text-sm text-slate-700">
                        <li>
                          <span className="font-medium">3114</span> — Prévention suicide
                        </li>
                        <li>
                          <span className="font-medium">3919</span> — Violences Femmes Info
                        </li>
                      </ul>
                    </div>
                  </div>

                  <div className="bg-white rounded-2xl shadow-xl p-6">
                    <h2 className="text-2xl font-bold text-slate-900 mb-4">Exporter les résultats</h2>
                    
                    <div className="space-y-3">
                      <button
                        onClick={handlePDF}
                        className="w-full bg-slate-900 hover:bg-slate-800 text-white font-semibold py-3 px-4 rounded-xl transition-all shadow-lg"
                      >
                        📄 Télécharger en PDF
                      </button>

                      <button
                        onClick={handleDownloadJSON}
                        className="w-full bg-slate-700 hover:bg-slate-600 text-white font-semibold py-3 px-4 rounded-xl transition-all"
                      >
                        💾 Exporter en JSON
                      </button>

                      <div className="pt-4 border-t-2 border-slate-100">
                        <label className="block text-sm font-medium text-slate-700 mb-2">
                          Envoyer par email
                        </label>
                        <div className="flex gap-2">
                          <input
                            type="email"
                            value={email}
                            onChange={(e) => setEmail(e.target.value)}
                            placeholder="email@exemple.com"
                            className="flex-1 rounded-lg border-2 border-slate-300 px-3 py-2 text-sm focus:border-indigo-500 focus:outline-none"
                          />
                          <button
                            onClick={handleEmail}
                            disabled={!email}
                            className="bg-indigo-600 disabled:bg-slate-300 disabled:cursor-not-allowed text-white font-semibold px-4 py-2 rounded-lg hover:bg-indigo-700 transition-all"
                          >
                            ✉️
                          </button>
                        </div>
                      </div>

                      <button
                        onClick={reset}
                        className="w-full mt-4 text-slate-600 hover:text-slate-900 font-medium text-sm underline"
                      >
                        Refaire le test
                      </button>
                    </div>
                  </div>
                </div>

                <div className="text-center text-xs text-slate-500 space-y-1">
                  <p className="font-semibold">NOÉSIS — « Es-tu entouré·e de cons ? » v2 • © 2025</p>
                  <p>Outil de repérage. Ne remplace pas un avis professionnel.</p>
                  <p>Confidentialité : aucune donnée collectée sans action explicite (RGPD)</p>
                </div>
              </div>

              {/* SECTION IMPRIMABLE PDF (cachée à l'écran) */}
              <div className="print-only print-container">
                <div className="print-section">
                  <h1 className="print-header">Résultats — Es-tu entouré·e de cons ? v2 (ICE)</h1>
                  <p className="print-text">Date : {new Date().toLocaleDateString('fr-FR')}</p>
                  <p className="print-text">Score ICE : <strong>{totalICE}/126</strong></p>
                  <p className="print-text">ISR (Indice Saturation Relationnelle) : <strong>{ISR}</strong></p>
                  <p className="print-text">Profil : <strong>{resultBand.band}</strong></p>
                </div>

                <div className="print-section">
                  <h2 className="print-subheader">Interprétation</h2>
                  <p className="print-text">{resultBand.message}</p>
                  <p className="print-text" style={{fontStyle: 'italic', color: '#64748b'}}>{resultBand.fun}</p>
                </div>

                <div className="print-section">
                  <h2 className="print-subheader">Scores par dimension</h2>
                  {DIMENSIONS.map(dim => {
                    const score = dimensionScores[dim.key];
                    const max = 18;
                    const percentage = Math.round((score / max) * 100);
                    return (
                      <div key={dim.key} className="print-score-box">
                        <p className="print-text"><strong>{dim.label}</strong> : {score}/{max} ({percentage}%)</p>
                        <p className="print-text" style={{paddingLeft: '8px', fontSize: '10px'}}>{dim.description}</p>
                      </div>
                    );
                  })}
                </div>

                <div className="print-section">
                  <h2 className="print-subheader">Recommandations</h2>
                  {resultBand.recommendations.map((rec, idx) => (
                    <p key={idx} className="print-reco">{idx + 1}. {rec}</p>
                  ))}
                </div>

                {/* DÉTAIL COMPLET DES QUESTIONS PAR AXE */}
                <div className="print-section" style={{pageBreakBefore: 'always'}}>
                  <h2 className="print-header">Détail des réponses par dimension</h2>
                  
                  {DIMENSIONS.map(dim => {
                    const dimQuestions = QUESTIONS.filter(q => q.dim === dim.key);
                    return (
                      <div key={dim.key} className="print-axis-section">
                        <h3 className="print-subheader">{dim.label}</h3>
                        {dimQuestions.map(q => {
                          const answer = CHOICES.find(c => c.value === answers[q.id]);
                          return (
                            <div key={q.id} className="print-question">
                              <p className="print-text">
                                <strong>{q.id}</strong> : {q.text}
                              </p>
                              <p className="print-text" style={{paddingLeft: '16px', color: '#4b5563'}}>
                                → Réponse : <strong>{answer?.label || 'Non répondu'}</strong> ({answer?.anchor || ''})
                              </p>
                            </div>
                          );
                        })}
                      </div>
                    );
                  })}
                </div>

                <div className="print-section" style={{marginTop: '20px', paddingTop: '12px', borderTop: '1px solid #e2e8f0'}}>
                  <p className="print-text" style={{fontSize: '10px', color: '#64748b'}}>
                    NOÉSIS — « Es-tu entouré·e de cons ? » v2 • © 2025 • Outil de repérage psychosocial, ne remplace pas un diagnostic professionnel
                  </p>
                  <p className="print-text" style={{fontSize: '10px', color: '#64748b'}}>
                    Références : Goleman (1995), Leymann (1996), Hirigoyen (1998), Sapolsky (2004), Porges (2011)
                  </p>
                </div>
              </div>
            </div>
          </div>
        );
      }
    }

    // ============================================================
    // RENDU DANS LE DOM
    // ============================================================

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<ICETest />);
  </script>
</body>
</html>
