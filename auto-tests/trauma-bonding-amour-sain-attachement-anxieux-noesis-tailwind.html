<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- SEO -->
  <title>Trauma Bonding vs Amour Sain vs Attachement Anxieux — Auto-test NOÉSIS</title>
  <meta name="description" content="Grille d'évaluation clinique (50 items) pour distinguer lien traumatique (trauma bonding), relation saine et attachement anxieux. 5 axes validés.">
  
  <!-- Open Graph -->
  <meta property="og:title" content="Trauma Bonding vs Amour Sain — NOÉSIS">
  <meta property="og:description" content="Test clinique 50 questions. Distinction lien traumatique, amour sain, attachement anxieux.">
  <meta property="og:type" content="website">
  
  <!-- Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- React + ReactDOM via CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- Babel Standalone pour JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <style>
    /* Styles d'impression PDF optimisés A4 */
    @media print {
      .no-print { display: none !important; }
      .print-only { display: block !important; }
      
      body { 
        background: white !important;
        margin: 0;
        padding: 0;
      }
      
      @page {
        size: A4;
        margin: 12mm 15mm;
      }
      
      .print-container {
        max-width: 100%;
        padding: 0 !important;
        margin: 0 !important;
      }
      
      .print-section {
        padding: 8px 0 !important;
        margin-bottom: 12px !important;
      }
      
      .print-header {
        font-size: 18px !important;
        margin-bottom: 8px !important;
        padding-bottom: 4px !important;
        border-bottom: 2px solid #334155;
      }
      
      .print-subheader {
        font-size: 14px !important;
        margin: 8px 0 4px 0 !important;
      }
      
      .print-text {
        font-size: 11px !important;
        line-height: 1.4 !important;
        margin: 2px 0 !important;
      }
      
      .print-question {
        font-size: 11px !important;
        padding: 3px 0 !important;
        page-break-inside: avoid;
      }
      
      .print-axis-section {
        page-break-inside: avoid;
        margin-bottom: 10px !important;
      }
      
      .print-score-box {
        padding: 6px !important;
        margin: 4px 0 !important;
        border: 1px solid #e2e8f0;
        border-radius: 4px;
      }
      
      .print-reco {
        font-size: 11px !important;
        padding: 2px 0 2px 16px !important;
        margin: 2px 0 !important;
      }
    }
    
    .print-only {
      display: none;
    }
  </style>
</head>
<body class="m-0 p-0">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useMemo, useCallback } = React;

    // ============================================================
    // CONFIGURATION
    // ============================================================

    const AXES = [
      { 
        key: "coercion", 
        label: "Dynamiques de coercition (trauma bonding)", 
        color: "rose",
        description: "Cycles alternance/dévalorisation, double contrainte, contrôle coercitif"
      },
      { 
        key: "anxious", 
        label: "Attachement anxieux (interne)", 
        color: "amber",
        description: "Hyperactivation, recherche validation, insécurité relationnelle"
      },
      { 
        key: "health", 
        label: "Marqueurs d'amour sain (réciprocité)", 
        color: "emerald",
        description: "Cohérence, respect mutuel, autonomie préservée, sécurité psychique"
      },
      { 
        key: "neuro", 
        label: "Neurostress & dépendance", 
        color: "purple",
        description: "Hypervigilance, altérations somatiques, dépendance émotionnelle"
      },
      { 
        key: "resilience", 
        label: "Régulation & ressources", 
        color: "sky",
        description: "Documentation factuelle, réseau soutien, stratégies protection"
      }
    ];

    const CHOICES = [
      { value: 0, label: "Jamais", anchor: "0 fois / 6 mois" },
      { value: 1, label: "Parfois", anchor: "1-3× / mois" },
      { value: 2, label: "Souvent", anchor: "1-3× / semaine" },
      { value: 3, label: "Très souvent", anchor: "Quasi quotidien" }
    ];

    const QUESTIONS = [
      // Coercition / trauma bonding (10)
      {id:"Q1", dim:"coercion", text:"Je vis des cycles 'idéalisation → dévalorisation → excuses' qui se répètent."},
      {id:"Q2", dim:"coercion", text:"Après des conflits, on me promet le changement sans suite durable."},
      {id:"Q3", dim:"coercion", text:"Je marche sur des œufs pour éviter colère, silence punitif ou jalousie."},
      {id:"Q4", dim:"coercion", text:"Je me sens isolé·e de mes proches à cause de la relation."},
      {id:"Q5", dim:"coercion", text:"Mes limites sont franchies (intrusion, contrôle, chantage affectif)."},
      {id:"Q6", dim:"coercion", text:"On invalide mes souvenirs ou on change la version des faits."},
      {id:"Q7", dim:"coercion", text:"Je ressens une forte intensité puis un retrait brutal et déstabilisant."},
      {id:"Q8", dim:"coercion", text:"On me fait porter la responsabilité des crises quoi que je fasse."},
      {id:"Q9", dim:"coercion", text:"Je me surprends à accepter l'inacceptable pour garder la relation."},
      {id:"Q10", dim:"coercion", text:"Je crains des représailles (rupture, menaces voilées) si j'affirme mes besoins."},
      
      // Attachement anxieux (10)
      {id:"Q11", dim:"anxious", text:"Je cherche souvent des preuves d'amour pour me rassurer."},
      {id:"Q12", dim:"anxious", text:"J'analyse les messages/temps de réponse jusqu'à angoisser."},
      {id:"Q13", dim:"anxious", text:"La distance ou l'autonomie de l'autre réactive un abandon ancien."},
      {id:"Q14", dim:"anxious", text:"Je m'adapte excessivement par peur de déplaire."},
      {id:"Q15", dim:"anxious", text:"Je ressens des pics de jalousie liés surtout à mon insécurité."},
      {id:"Q16", dim:"anxious", text:"Je catastrophise vite ('il/elle va partir')."},
      {id:"Q17", dim:"anxious", text:"J'ai besoin d'être souvent validé·e pour me sentir en sécurité."},
      {id:"Q18", dim:"anxious", text:"Même avec quelqu'un de bienveillant, je doute de sa sincérité."},
      {id:"Q19", dim:"anxious", text:"Je fusionne facilement et j'ai du mal à garder mes repères."},
      {id:"Q20", dim:"anxious", text:"Je rumine longtemps après des interactions neutres."},
      
      // Marqueurs sains (10)
      {id:"Q21", dim:"health", text:"Nos paroles et nos actes sont globalement cohérents et stables."},
      {id:"Q22", dim:"health", text:"Le désaccord est possible sans punition ni menace."},
      {id:"Q23", dim:"health", text:"Nous respectons l'autonomie, l'amitié et la vie privée de chacun."},
      {id:"Q24", dim:"health", text:"Les limites exprimées sont entendues et respectées."},
      {id:"Q25", dim:"health", text:"Les excuses sont suivies d'actes concrets et durables."},
      {id:"Q26", dim:"health", text:"La répartition du pouvoir est équilibrée ; je peux dire non."},
      {id:"Q27", dim:"health", text:"Les échanges restent bienveillants, sans humiliation ni ironie blessante."},
      {id:"Q28", dim:"health", text:"Les jalousies/peurs sont parlées et régulées à deux."},
      {id:"Q29", dim:"health", text:"Je me sens globalement en sécurité psychique et physique."},
      {id:"Q30", dim:"health", text:"Chacun soutient les projets et l'essor de l'autre."},
      
      // Neurostress & dépendance (10)
      {id:"Q31", dim:"neuro", text:"Je suis en hypervigilance (anticipation, tension) liée à la relation."},
      {id:"Q32", dim:"neuro", text:"Mon sommeil/appétit/attention se dégradent sans autre cause évidente."},
      {id:"Q33", dim:"neuro", text:"Je vis des montagnes russes émotionnelles après messages/rencontres."},
      {id:"Q34", dim:"neuro", text:"J'éprouve un soulagement physique quand l'autre est absent."},
      {id:"Q35", dim:"neuro", text:"Je doute de ma mémoire après les conflits (flou, confusion)."},
      {id:"Q36", dim:"neuro", text:"Je relis/édite mes messages par peur de déclencher une crise."},
      {id:"Q37", dim:"neuro", text:"Je m'éloigne de mes centres d'intérêt/amis par épuisement relationnel."},
      {id:"Q38", dim:"neuro", text:"Je ressens une dépendance ('je ne peux pas partir') malgré la souffrance."},
      {id:"Q39", dim:"neuro", text:"Je me sens 'addict' aux phases d'intensité suivies de manque."},
      {id:"Q40", dim:"neuro", text:"Je rationalise l'inacceptable pour réduire ma dissonance."},
      
      // Régulation & résilience (10)
      {id:"Q41", dim:"resilience", text:"Je note des faits/objectifs pour stabiliser ma réalité."},
      {id:"Q42", dim:"resilience", text:"Je reconnais des signaux d'alerte (emprise, dénigrement)."},
      {id:"Q43", dim:"resilience", text:"Je sais identifier les cycles et patterns récurrents."},
      {id:"Q44", dim:"resilience", text:"Je consulte proches de confiance pour valider ma perception."},
      {id:"Q45", dim:"resilience", text:"Je maintiens liens externes (amis, famille, hobbies)."},
      {id:"Q46", dim:"resilience", text:"Je pose/renégocie mes limites quand elles sont franchies."},
      {id:"Q47", dim:"resilience", text:"Je demande aide (thérapeute, association) si besoin."},
      {id:"Q48", dim:"resilience", text:"J'ai un plan de sortie (lieu sûr, ressources, contacts)."},
      {id:"Q49", dim:"resilience", text:"Je prends du recul avant de réagir émotionnellement."},
      {id:"Q50", dim:"resilience", text:"Je me protège financièrement/juridiquement si nécessaire."}
    ];

    // ============================================================
    // FONCTIONS DE SCORING
    // ============================================================

    function getProfile(scores) {
      const { coercion, anxious, health, neuro, resilience } = scores;
      
      // Trauma bonding dominant
      if (coercion >= 18 && neuro >= 18) {
        return {
          type: "trauma",
          label: "Lien traumatique probable",
          color: "red",
          summary: "Vos scores révèlent des dynamiques de coercition élevées et un neurostress important. Cette configuration suggère un lien traumatique (trauma bonding) nécessitant une attention immédiate et un accompagnement spécialisé.",
          recommendations: [
            "PRIORITÉ ABSOLUE : Consulter psychotraumatologue ou thérapeute formé aux violences conjugales dans les 7 jours.",
            "Documenter factuellement tous les incidents (dates, faits, témoins, captures écran) dans journal sécurisé ou cloud.",
            "Contacter association spécialisée : 3919 (violences conjugales), AVFT, En Avant Toute(s), Solidarité Femmes.",
            "Créer plan de sécurité : lieu refuge identifié, argent accessible, doubles documents, contacts d'urgence.",
            "Informer proches de confiance de la situation réelle sans minimiser.",
            "Protocole de régulation intensive : cohérence cardiaque, grounding, activité physique douce quotidienne.",
            "Évaluation médicale si symptômes somatiques (troubles sommeil, douleurs chroniques, dissociation).",
            "Lecture validation : Dee Graham (Loving to Survive), Lundy Bancroft (Why Does He Do That?), Pete Walker (CPTSD).",
            "Protection juridique si nécessaire : main courante, ordonnance de protection, avocat spécialisé violences.",
            "JAMAIS confronter la personne violente avec le terme 'trauma bonding' ou 'pervers narcissique' : danger d'escalade."
          ],
          urgent: true
        };
      }
      
      // Attachement anxieux dominant avec relation saine
      if (anxious >= 18 && health >= 18 && coercion < 12) {
        return {
          type: "anxieux",
          label: "Attachement anxieux dans relation globalement saine",
          color: "yellow",
          summary: "Vos scores indiquent un attachement anxieux significatif dans une relation présentant des marqueurs de santé relationnelle. Le travail thérapeutique sur l'attachement peut améliorer votre sécurité intérieure.",
          recommendations: [
            "Psychothérapie focalisée attachement : EMDR, IFS (Internal Family Systems), thérapie émotionnelle focalisée (TFE).",
            "Lectures spécialisées : Amir Levine & Rachel Heller (Attached), Sue Johnson (Hold Me Tight), Diane Poole Heller (Power of Attachment).",
            "Pratiques de régulation émotionnelle : méditation pleine conscience, cohérence cardiaque, journal des émotions.",
            "Communication relationnelle : exprimer besoins d'attachement sans honte, négocier rituels de connexion.",
            "Travail sur blessures originelles : explorer attachement enfance, patterns répétés, voix critique internalisée.",
            "Développer autonomie émotionnelle : hobbies personnels, réseau amical stable, validation interne progressive.",
            "Groupes de soutien : communautés attachement anxieux, forums thérapeutiques modérés."
          ],
          urgent: false
        };
      }
      
      // Profil mixte
      if (coercion >= 12 && anxious >= 15) {
        return {
          type: "mixte",
          label: "Mixte (attachement anxieux + signaux coercitifs)",
          color: "orange",
          summary: "Votre situation combine vulnérabilité interne (attachement anxieux) et éléments de coercition externe. Une double approche est recommandée : travail personnel ET clarification du cadre relationnel.",
          recommendations: [
            "Évaluation psychologique différentielle : distinguer insécurité interne vs manipulation externe réelle.",
            "Documenter factuellement comportements problématiques pour objectiver la situation.",
            "Thérapie individuelle prioritaire avant thérapie de couple (risque d'aggravation si violence présente).",
            "Lecture : Lundy Bancroft (Should I Stay or Should I Go?), Patricia Evans (Controlling People).",
            "Créer distance émotionnelle temporaire pour clarifier perceptions (contact réduit, séjour ailleurs si possible).",
            "Consulter proches non impliqués pour validation externe ('est-ce que ce comportement vous semble normal ?').",
            "Plan B préparé si escalade : hébergement, ressources financières, contacts professionnels.",
            "Groupe de parole violences conjugales ou attachement selon dominante identifiée."
          ],
          urgent: false
        };
      }
      
      // Relation globalement saine
      if (health >= 20 && coercion < 10 && neuro < 10) {
        return {
          type: "sain",
          label: "Relation majoritairement saine",
          color: "green",
          summary: "Vos scores témoignent d'une relation globalement équilibrée avec des marqueurs de réciprocité et de respect mutuel. Les difficultés identifiées relèvent de l'ajustement relationnel normal.",
          recommendations: [
            "Continuer à cultiver communication bienveillante et négociation des besoins.",
            "Maintenir autonomie individuelle (amis, hobbies, projets personnels).",
            "Lecture relationnelle : John Gottman (Les couples heureux ont leurs secrets), Sue Johnson (Hold Me Tight).",
            "Pratiques de connexion : rituels quotidiens, écoute active, gratitude exprimée.",
            "Thérapie de couple préventive si ajustements nécessaires (sans urgence).",
            "Vigilance ordinaire : maintenir conscience des patterns sains, réagir si dérive."
          ],
          urgent: false
        };
      }
      
      // Par défaut
      return {
        type: "evaluation",
        label: "Situation nécessitant évaluation approfondie",
        color: "gray",
        summary: "Vos scores présentent une configuration mixte nécessitant une évaluation clinique personnalisée pour distinguer les sources de difficultés.",
        recommendations: [
          "Consultation psychologique individuelle pour clarifier la nature des difficultés.",
          "Documentation factuelle des comportements problématiques observés.",
          "Lectures exploratoires : attachement (Levine & Heller), coercition (Bancroft), trauma (Walker).",
          "Maintenir réseau de soutien stable et diversifié.",
          "Éviter décisions majeures (rupture, engagement) avant clarification diagnostique."
        ],
        urgent: false
      };
    }

    function getAxisAnalysis(dimScores) {
      const sorted = Object.entries(dimScores)
        .map(([key, score]) => ({ key, score, dim: AXES.find(d => d.key === key) }))
        .sort((a, b) => b.score - a.score);
      
      const dominant = sorted[0];
      
      const analyses = {
        coercion: "Les dynamiques de coercition dominent votre profil. Vous êtes probablement exposé·e à des cycles de manipulation (idéalisation/dévalorisation), invalidation de votre réalité et contrôle coercitif. Cette configuration suggère un lien traumatique nécessitant protection et accompagnement spécialisé.",
        anxious: "L'attachement anxieux est votre dimension dominante. Votre insécurité relationnelle génère une hypervigilance émotionnelle, une quête constante de validation et une peur d'abandon chronique. Ce schéma trouve souvent son origine dans l'enfance et peut être travaillé thérapeutiquement.",
        health: "Les marqueurs d'amour sain dominent votre profil. Votre relation présente des caractéristiques de réciprocité, respect mutuel, cohérence et sécurité psychique. Les difficultés identifiées relèvent probablement d'ajustements relationnels ordinaires.",
        neuro: "Le neurostress et la dépendance émotionnelle sont au cœur de votre souffrance. Votre système nerveux témoigne d'un stress relationnel chronique : hypervigilance, altérations cognitives, dépendance affective, rationalisations. Cette dimension nécessite régulation intensive et accompagnement.",
        resilience: "Vos ressources de régulation et résilience sont développées. Vous documentez factuellement, identifiez les patterns problématiques, maintenez liens externes et posez des limites. Ces capacités sont des facteurs protecteurs majeurs face aux dynamiques toxiques."
      };
      
      return {
        dominant: dominant.key,
        analysis: analyses[dominant.key]
      };
    }

    // ============================================================
    // COMPOSANT PRINCIPAL
    // ============================================================

    function TraumaBondingTest() {
      const [page, setPage] = useState("intro");
      const [currentQ, setCurrentQ] = useState(0);
      const [answers, setAnswers] = useState({});
      const [email, setEmail] = useState("");

      // SUPPRESSION TOTALE localStorage — Test toujours vierge

      const allAnswered = Object.keys(answers).length === QUESTIONS.length;

      const handleAnswer = useCallback((qId, value) => {
        setAnswers(prev => ({ ...prev, [qId]: value }));
        
        if (currentQ < QUESTIONS.length - 1) {
          setTimeout(() => setCurrentQ(c => c + 1), 150);
        }
      }, [currentQ]);

      const goToResults = useCallback(() => {
        if (!allAnswered) {
          alert(`Il reste ${QUESTIONS.length - Object.keys(answers).length} question(s) sans réponse.`);
          return;
        }
        setPage("results");
      }, [allAnswered, answers]);

      const reset = useCallback(() => {
        setAnswers({});
        setCurrentQ(0);
        setPage("intro");
        setEmail("");
      }, []);

      const dimensionScores = useMemo(() => {
        const scores = {};
        AXES.forEach(axis => {
          const qs = QUESTIONS.filter(q => q.dim === axis.key);
          const total = qs.reduce((sum, q) => sum + (answers[q.id] || 0), 0);
          scores[axis.key] = total;
        });
        return scores;
      }, [answers]);

      const totalScore = useMemo(() => {
        return Object.values(dimensionScores).reduce((a, b) => a + b, 0);
      }, [dimensionScores]);

      const resultProfile = useMemo(() => getProfile(dimensionScores), [dimensionScores]);
      const profileAnalysis = useMemo(() => getAxisAnalysis(dimensionScores), [dimensionScores]);

      const handlePDF = useCallback(() => {
        window.print();
      }, []);

      const handleDownloadJSON = useCallback(() => {
        const data = {
          test: "Trauma Bonding vs Amour Sain vs Attachement Anxieux",
          date: new Date().toISOString(),
          totalScore,
          profileType: resultProfile.label,
          dimensionScores,
          answers: QUESTIONS.map(q => ({
            id: q.id,
            dimension: q.dim,
            question: q.text,
            answer: CHOICES.find(c => c.value === answers[q.id])?.label || "Non répondu"
          }))
        };
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `noesis-trauma-bonding-${new Date().toISOString().split('T')[0]}.json`;
        a.click();
        URL.revokeObjectURL(url);
      }, [totalScore, resultProfile, dimensionScores, answers]);

      const handleEmail = useCallback(() => {
        if (!email) return;
        const subject = encodeURIComponent("Résultats Auto-test Trauma Bonding");
        const body = encodeURIComponent(
          `Bonjour,\n\nVoici mes résultats au test Trauma Bonding NOÉSIS :\n\n` +
          `Score total : ${totalScore}/150\n` +
          `Profil : ${resultProfile.label}\n\n` +
          `Scores par dimension :\n` +
          AXES.map(d => `- ${d.label} : ${dimensionScores[d.key]}`).join('\n') +
          `\n\nPour consulter le détail complet, merci de télécharger le PDF ou JSON depuis le site.`
        );
        window.location.href = `mailto:${email}?subject=${subject}&body=${body}`;
      }, [email, totalScore, resultProfile, dimensionScores]);

      const progress = useMemo(() => Math.round((currentQ / QUESTIONS.length) * 100), [currentQ]);

      // ============================================================
      // PAGE INTRO
      // ============================================================
      
      if (page === "intro") {
        return (
          <div className="min-h-screen bg-gradient-to-br from-slate-50 via-indigo-50 to-purple-50 p-4 md:p-8">
            <div className="max-w-3xl mx-auto">
              <div className="text-center mb-8">
                <div className="inline-block p-4 bg-indigo-100 rounded-2xl mb-4">
                  <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="text-indigo-600">
                    <path d="M9.5 2c-1.82 0-3.53.5-5 1.36C2.68 4.72 1.5 6.73 1.5 9c0 1.56.52 3 1.39 4.14.87 1.14 2.07 2 3.43 2.36"/>
                    <path d="M14.5 2c1.82 0 3.53.5 5 1.36C21.32 4.72 22.5 6.73 22.5 9c0 1.56-.52 3-1.39 4.14-.87 1.14-2.07 2-3.43 2.36"/>
                    <path d="M12 2v20"/>
                    <path d="M9.5 15.5c0 1.38.62 2.5 1.5 2.5"/>
                    <path d="M14.5 15.5c0 1.38-.62 2.5-1.5 2.5"/>
                    <circle cx="9" cy="9" r="1" fill="currentColor"/>
                    <circle cx="15" cy="9" r="1" fill="currentColor"/>
                  </svg>
                </div>
                <h1 className="text-4xl md:text-5xl font-black text-slate-900 mb-3">
                  Trauma Bonding vs Amour Sain
                </h1>
                <p className="text-lg text-slate-600 font-medium">
                  Grille différentielle — 50 items validés
                </p>
              </div>

              <div className="bg-white rounded-2xl shadow-2xl p-6 md:p-8 mb-6">
                <div className="bg-amber-50 border-l-4 border-amber-500 p-4 mb-6 rounded-r-lg">
                  <div className="flex gap-3">
                    <span className="text-2xl flex-shrink-0">⚠️</span>
                    <div className="text-sm text-amber-900">
                      <p className="font-bold mb-1">Avertissement méthodologique</p>
                      <p className="leading-relaxed">
                        Cette grille différentielle <strong>ne remplace pas un diagnostic professionnel</strong>. 
                        Elle vise à distinguer lien traumatique (trauma bonding), attachement anxieux et marqueurs de relation saine. 
                        En cas de scores élevés sur coercition, une consultation spécialisée violences conjugales est impérative.
                      </p>
                    </div>
                  </div>
                </div>

                <div className="mb-8">
                  <div className="flex items-center gap-2 mb-4">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="text-slate-700">
                      <circle cx="11" cy="11" r="8"/>
                      <path d="m21 21-4.35-4.35"/>
                      <circle cx="11" cy="11" r="3"/>
                    </svg>
                    <h2 className="text-xl font-bold text-slate-900">Méthodologie</h2>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-3 mb-6">
                    <div className="bg-rose-50 text-rose-700 px-3 py-2 rounded-lg text-center text-sm font-semibold">
                      Coercition (trauma bonding)
                    </div>
                    <div className="bg-amber-50 text-amber-700 px-3 py-2 rounded-lg text-center text-sm font-semibold">
                      Attachement anxieux
                    </div>
                    <div className="bg-emerald-50 text-emerald-700 px-3 py-2 rounded-lg text-center text-sm font-semibold">
                      Marqueurs sains
                    </div>
                    <div className="bg-purple-50 text-purple-700 px-3 py-2 rounded-lg text-center text-sm font-semibold">
                      Neurostress
                    </div>
                    <div className="bg-sky-50 text-sky-700 px-3 py-2 rounded-lg text-center text-sm font-semibold col-span-full">
                      Régulation & ressources
                    </div>
                  </div>

                  <div className="prose prose-sm text-slate-700 space-y-3">
                    <p className="leading-relaxed">
                      Cette grille évalue <strong>cinq dimensions relationnelles différentielles</strong> : 
                      dynamiques de coercition (cycles manipulation, contrôle), attachement anxieux interne (insécurité, hyperactivation), 
                      marqueurs d'amour sain (réciprocité, cohérence, respect), neurostress et dépendance émotionnelle, 
                      ressources de régulation et résilience. Évaluation sur les <strong>6 derniers mois</strong>.
                    </p>
                  </div>
                </div>

                <div className="grid md:grid-cols-3 gap-4 mb-8">
                  <div className="bg-slate-50 p-4 rounded-xl text-center">
                    <div className="flex justify-center mb-2">
                      <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="text-indigo-600">
                        <circle cx="12" cy="13" r="9"/>
                        <polyline points="12 7 12 13 15 15"/>
                        <path d="M10 2h4"/>
                      </svg>
                    </div>
                    <div className="text-2xl font-bold text-slate-900">15-20 min</div>
                    <div className="text-sm text-slate-600">Durée estimée</div>
                  </div>
                  <div className="bg-slate-50 p-4 rounded-xl text-center">
                    <div className="flex justify-center mb-2">
                      <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="text-indigo-600">
                        <line x1="18" y1="20" x2="18" y2="10"/>
                        <line x1="12" y1="20" x2="12" y2="4"/>
                        <line x1="6" y1="20" x2="6" y2="14"/>
                      </svg>
                    </div>
                    <div className="text-2xl font-bold text-slate-900">50 questions</div>
                    <div className="text-sm text-slate-600">Grille différentielle</div>
                  </div>
                  <div className="bg-slate-50 p-4 rounded-xl text-center">
                    <div className="flex justify-center mb-2">
                      <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="text-indigo-600">
                        <path d="M3 3v18h18"/>
                        <path d="M18 9l-5 5-4-4-4 4"/>
                        <circle cx="18" cy="9" r="2" fill="currentColor"/>
                        <circle cx="13" cy="14" r="2" fill="currentColor"/>
                        <circle cx="9" cy="10" r="2" fill="currentColor"/>
                        <circle cx="5" cy="14" r="2" fill="currentColor"/>
                      </svg>
                    </div>
                    <div className="text-2xl font-bold text-slate-900">5 dimensions</div>
                    <div className="text-sm text-slate-600">Analyse multi-axes</div>
                  </div>
                </div>

                <button
                  onClick={() => setPage("test")}
                  className="w-full bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white text-lg font-bold py-4 px-6 rounded-xl transition-all shadow-lg hover:shadow-xl"
                >
                  Commencer l'évaluation →
                </button>
              </div>

              <div className="text-center text-xs text-slate-500 space-y-1">
                <p className="font-semibold">NOÉSIS — Trauma Bonding v1.0 • © 2025</p>
                <p>Confidentialité : aucune donnée collectée sans action explicite (RGPD)</p>
              </div>
            </div>
          </div>
        );
      }

      // ============================================================
      // PAGE TEST
      // ============================================================

      if (page === "test") {
        const q = QUESTIONS[currentQ];
        const dimInfo = AXES.find(d => d.key === q.dim);
        const colorMap = {
          rose: { bg: "bg-rose-50", border: "border-rose-300", text: "text-rose-700", badge: "bg-rose-100 text-rose-700" },
          amber: { bg: "bg-amber-50", border: "border-amber-300", text: "text-amber-700", badge: "bg-amber-100 text-amber-700" },
          emerald: { bg: "bg-emerald-50", border: "border-emerald-300", text: "text-emerald-700", badge: "bg-emerald-100 text-emerald-700" },
          purple: { bg: "bg-purple-50", border: "border-purple-300", text: "text-purple-700", badge: "bg-purple-100 text-purple-700" },
          sky: { bg: "bg-sky-50", border: "border-sky-300", text: "text-sky-700", badge: "bg-sky-100 text-sky-700" },
        };
        const colors = colorMap[dimInfo.color];

        return (
          <div className="min-h-screen bg-gradient-to-br from-slate-50 via-indigo-50 to-purple-50 p-4 md:p-8">
            <div className="max-w-3xl mx-auto">
              
              <div className="mb-6">
                <div className="flex justify-between items-center mb-2">
                  <span className="text-sm font-medium text-slate-600">
                    Question {currentQ + 1} / {QUESTIONS.length}
                  </span>
                  <span className="text-sm font-bold text-indigo-600">{progress}%</span>
                </div>
                <div className="w-full bg-slate-200 rounded-full h-3 overflow-hidden">
                  <div 
                    className="h-full bg-gradient-to-r from-indigo-500 to-purple-500 transition-all duration-300"
                    style={{ width: `${progress}%` }}
                  />
                </div>
              </div>

              <div className="bg-white rounded-2xl shadow-2xl p-6 md:p-8 mb-6">
                <div className="flex items-center gap-3 mb-6">
                  <div className={`w-12 h-12 rounded-full ${colors.bg} ${colors.border} border-2 flex items-center justify-center font-bold ${colors.text} text-lg`}>
                    {currentQ + 1}
                  </div>
                  <span className={`px-3 py-1 rounded-full text-xs font-semibold ${colors.badge}`}>
                    {dimInfo.label}
                  </span>
                </div>

                <h2 className="text-xl md:text-2xl font-bold text-slate-900 mb-8 leading-relaxed">
                  {q.text}
                </h2>

                <div className="space-y-3">
                  {CHOICES.map(choice => {
                    const isSelected = answers[q.id] === choice.value;
                    return (
                      <button
                        key={choice.value}
                        onClick={() => handleAnswer(q.id, choice.value)}
                        className={`w-full text-left p-4 rounded-xl border-2 transition-all ${
                          isSelected
                            ? 'bg-indigo-50 border-indigo-500 shadow-lg'
                            : 'bg-white border-slate-200 hover:border-indigo-300 hover:bg-slate-50'
                        }`}
                      >
                        <div className="flex items-center justify-between">
                          <div>
                            <div className={`font-semibold mb-1 ${isSelected ? 'text-indigo-700' : 'text-slate-900'}`}>
                              {choice.label}
                            </div>
                            <div className="text-xs text-slate-500">{choice.anchor}</div>
                          </div>
                          <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center ${
                            isSelected ? 'bg-indigo-500 border-indigo-500' : 'border-slate-300'
                          }`}>
                            {isSelected && <span className="text-white text-xs font-bold">✓</span>}
                          </div>
                        </div>
                      </button>
                    );
                  })}
                </div>
              </div>

              <div className="flex gap-4">
                <button
                  onClick={() => setCurrentQ(c => Math.max(0, c - 1))}
                  disabled={currentQ === 0}
                  className="flex-1 bg-slate-200 hover:bg-slate-300 disabled:bg-slate-100 disabled:text-slate-400 text-slate-700 font-semibold py-3 px-6 rounded-xl transition"
                >
                  ← Précédent
                </button>
                
                {currentQ === QUESTIONS.length - 1 ? (
                  <button
                    onClick={goToResults}
                    disabled={!allAnswered}
                    className="flex-1 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 disabled:from-slate-300 disabled:to-slate-300 text-white font-bold py-3 px-6 rounded-xl transition-all shadow-lg"
                  >
                    Voir les résultats →
                  </button>
                ) : (
                  <button
                    onClick={() => setCurrentQ(c => Math.min(QUESTIONS.length - 1, c + 1))}
                    className="flex-1 bg-slate-700 hover:bg-slate-800 text-white font-semibold py-3 px-6 rounded-xl transition"
                  >
                    Suivant →
                  </button>
                )}
              </div>

              <div className="mt-4 text-center">
                <button
                  onClick={goToResults}
                  disabled={!allAnswered}
                  className="text-sm text-slate-500 hover:text-slate-700 underline disabled:text-slate-300"
                >
                  {allAnswered ? "Aller directement aux résultats" : `${QUESTIONS.length - Object.keys(answers).length} question(s) restante(s)`}
                </button>
              </div>
            </div>
          </div>
        );
      }

      // ============================================================
      // PAGE RÉSULTATS + SECTION IMPRIMABLE
      // ============================================================

      return (
        <div className="min-h-screen bg-gradient-to-br from-slate-50 via-indigo-50 to-purple-50 p-4 md:p-8">
          <div className="max-w-5xl mx-auto">
            
            {/* SECTION ÉCRAN */}
            <div className="no-print">
              <div className="text-center mb-8">
                <div className="inline-block p-4 bg-gradient-to-br from-indigo-100 to-purple-100 rounded-2xl mb-4">
                  <svg width="56" height="56" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="text-indigo-600">
                    <path d="M3 3v18h18"/>
                    <path d="M18 9l-5 5-4-4-4 4"/>
                    <circle cx="18" cy="9" r="2"/>
                    <circle cx="13" cy="14" r="2"/>
                    <circle cx="9" cy="10" r="2"/>
                    <circle cx="5" cy="14" r="2"/>
                  </svg>
                </div>
                <h1 className="text-4xl md:text-5xl font-black text-slate-900 mb-3">
                  Tes résultats
                </h1>
                <p className="text-lg text-slate-600 font-medium">
                  Analyse différentielle de ta dynamique relationnelle
                </p>
              </div>

              <div className="bg-white rounded-2xl shadow-2xl p-6 md:p-8 mb-6">
                <div className="text-center mb-6">
                  <div className="text-6xl font-black text-slate-900 mb-2">
                    {totalScore}<span className="text-3xl text-slate-400">/150</span>
                  </div>
                  <div className={`inline-block px-6 py-2 rounded-full text-lg font-bold ${
                    resultProfile.color === 'green' ? 'bg-green-100 text-green-700' :
                    resultProfile.color === 'yellow' ? 'bg-yellow-100 text-yellow-700' :
                    resultProfile.color === 'orange' ? 'bg-orange-100 text-orange-700' :
                    resultProfile.color === 'red' ? 'bg-red-100 text-red-700' :
                    'bg-gray-100 text-gray-700'
                  }`}>
                    {resultProfile.label}
                  </div>
                </div>

                {resultProfile.urgent && (
                  <div className="bg-red-50 border-l-4 border-red-500 p-4 mb-6 rounded-r-lg">
                    <div className="flex gap-3">
                      <span className="text-2xl flex-shrink-0">🚨</span>
                      <div className="text-sm text-red-900">
                        <p className="font-bold">Situation nécessitant une action urgente</p>
                      </div>
                    </div>
                  </div>
                )}

                <div className="bg-slate-50 p-6 rounded-2xl mb-6">
                  <h3 className="font-bold text-slate-900 mb-3">🔍 Interprétation différentielle</h3>
                  <p className="text-sm text-slate-700 leading-relaxed">
                    {resultProfile.summary}
                  </p>
                </div>

                <div className="space-y-4 mb-6">
                  <h3 className="font-bold text-slate-900">Scores par dimension</h3>
                  {AXES.map(axis => {
                    const score = dimensionScores[axis.key];
                    const max = QUESTIONS.filter(q => q.dim === axis.key).length * 3;
                    const percentage = Math.round((score / max) * 100);
                    const colorMap = {
                      rose: { bg: "bg-rose-50", bar: "bg-rose-500", text: "text-rose-700" },
                      amber: { bg: "bg-amber-50", bar: "bg-amber-500", text: "text-amber-700" },
                      emerald: { bg: "bg-emerald-50", bar: "bg-emerald-500", text: "text-emerald-700" },
                      purple: { bg: "bg-purple-50", bar: "bg-purple-500", text: "text-purple-700" },
                      sky: { bg: "bg-sky-50", bar: "bg-sky-500", text: "text-sky-700" },
                    };
                    const colors = colorMap[axis.color];
                    
                    return (
                      <div key={axis.key} className={`p-4 rounded-xl ${colors.bg}`}>
                        <div className="flex justify-between items-center mb-2">
                          <span className={`text-sm font-bold ${colors.text}`}>{axis.label}</span>
                          <span className="text-sm font-bold text-slate-700">{score}/{max}</span>
                        </div>
                        <div className="w-full bg-white rounded-full h-3 overflow-hidden">
                          <div 
                            className={`h-full ${colors.bar} transition-all duration-500`}
                            style={{ width: `${percentage}%` }}
                          />
                        </div>
                        <div className="text-xs text-slate-600 mt-1">{percentage}%</div>
                      </div>
                    );
                  })}
                </div>

                <div className="bg-slate-50 p-6 rounded-2xl">
                  <h3 className="font-bold text-slate-900 mb-3">📌 Ton profil dominant</h3>
                  <p className="text-sm font-semibold text-indigo-600 mb-2">
                    {AXES.find(d => d.key === profileAnalysis.dominant)?.label}
                  </p>
                  <p className="text-sm text-slate-700 leading-relaxed">
                    {profileAnalysis.analysis}
                  </p>
                </div>
              </div>

              <div className="grid md:grid-cols-2 gap-6">
                
                <div className="bg-white rounded-2xl shadow-xl p-6">
                  <h2 className="text-xl font-bold text-slate-900 mb-4">Recommandations</h2>
                  <ul className="space-y-3">
                    {resultProfile.recommendations.map((rec, idx) => (
                      <li key={idx} className="flex gap-3 text-sm text-slate-700">
                        <span className="flex-shrink-0 w-6 h-6 rounded-full bg-indigo-100 text-indigo-600 font-bold text-xs flex items-center justify-center">
                          {idx + 1}
                        </span>
                        <span>{rec}</span>
                      </li>
                    ))}
                  </ul>

                  {resultProfile.urgent && (
                    <div className="mt-6 pt-6 border-t-2 border-slate-100">
                      <h3 className="font-bold text-slate-900 mb-3">Ressources d'urgence</h3>
                      <ul className="space-y-2 text-sm">
                        <li>
                          <span className="text-slate-900 font-medium">3919</span>
                          <span className="text-slate-600"> — Violences conjugales (24/7)</span>
                        </li>
                        <li>
                          <span className="text-slate-900 font-medium">116 006</span>
                          <span className="text-slate-600"> — Aide aux victimes</span>
                        </li>
                        <li>
                          <span className="text-slate-900 font-medium">En Avant Toute(s)</span>
                          <span className="text-slate-600"> — Chat violences conjugales</span>
                        </li>
                      </ul>
                    </div>
                  )}
                </div>

                <div className="bg-white rounded-2xl shadow-xl p-6">
                  <h2 className="text-xl font-bold text-slate-900 mb-4">Exporter les résultats</h2>
                  
                  <div className="space-y-3">
                    <button
                      onClick={handlePDF}
                      className="w-full bg-slate-900 text-white font-semibold py-3 px-4 rounded-xl hover:bg-slate-800 transition"
                    >
                      📄 Télécharger en PDF
                    </button>

                    <button
                      onClick={handleDownloadJSON}
                      className="w-full bg-slate-700 text-white font-semibold py-3 px-4 rounded-xl hover:bg-slate-600 transition"
                    >
                      💾 Télécharger en JSON
                    </button>

                    <div className="pt-4 border-t-2 border-slate-100">
                      <label className="block text-sm font-medium text-slate-700 mb-2">
                        Envoyer par email
                      </label>
                      <div className="flex gap-2">
                        <input
                          type="email"
                          value={email}
                          onChange={(e) => setEmail(e.target.value)}
                          placeholder="email@exemple.com"
                          className="flex-1 rounded-lg border-2 border-slate-300 px-3 py-2 text-sm focus:border-indigo-500 focus:outline-none"
                        />
                        <button
                          onClick={handleEmail}
                          disabled={!email}
                          className="bg-indigo-600 disabled:bg-slate-300 text-white font-semibold px-4 py-2 rounded-lg hover:bg-indigo-700 transition"
                        >
                          📧
                        </button>
                      </div>
                    </div>

                    <button
                      onClick={reset}
                      className="w-full mt-4 text-slate-600 hover:text-slate-900 font-medium underline text-sm"
                    >
                      Refaire le test
                    </button>
                  </div>
                </div>
              </div>

              <div className="mt-8 text-center text-xs text-slate-500 space-y-2">
                <p className="font-semibold">NOÉSIS — Trauma Bonding v1.0 • © 2025</p>
                <p>Outil de pré-diagnostic d'orientation • Pas un diagnostic médical</p>
                <p>Confidentialité : aucune donnée collectée sans action explicite (RGPD)</p>
              </div>
            </div>

            {/* SECTION IMPRIMABLE PDF (cachée à l'écran) */}
            <div className="print-only print-container">
              <div className="print-section">
                <h1 className="print-header">Résultats — Trauma Bonding vs Amour Sain</h1>
                <p className="print-text">Date : {new Date().toLocaleDateString('fr-FR')}</p>
                <p className="print-text">Score total : <strong>{totalScore}/150</strong></p>
                <p className="print-text">Profil : <strong>{resultProfile.label}</strong></p>
              </div>

              <div className="print-section">
                <h2 className="print-subheader">Interprétation différentielle</h2>
                <p className="print-text">{resultProfile.summary}</p>
              </div>

              <div className="print-section">
                <h2 className="print-subheader">Scores par dimension</h2>
                {AXES.map(axis => {
                  const score = dimensionScores[axis.key];
                  const max = QUESTIONS.filter(q => q.dim === axis.key).length * 3;
                  const percentage = Math.round((score / max) * 100);
                  return (
                    <div key={axis.key} className="print-score-box">
                      <p className="print-text"><strong>{axis.label}</strong> : {score}/{max} ({percentage}%)</p>
                    </div>
                  );
                })}
              </div>

              <div className="print-section">
                <h2 className="print-subheader">Profil dominant</h2>
                <p className="print-text"><strong>{AXES.find(d => d.key === profileAnalysis.dominant)?.label}</strong></p>
                <p className="print-text">{profileAnalysis.analysis}</p>
              </div>

              <div className="print-section">
                <h2 className="print-subheader">Recommandations</h2>
                {resultProfile.recommendations.map((rec, idx) => (
                  <p key={idx} className="print-reco">{idx + 1}. {rec}</p>
                ))}
              </div>

              {/* DÉTAIL COMPLET DES QUESTIONS PAR AXE */}
              <div className="print-section" style={{pageBreakBefore: 'always'}}>
                <h2 className="print-header">Détail des réponses par dimension</h2>
                
                {AXES.map(axis => {
                  const axisQuestions = QUESTIONS.filter(q => q.dim === axis.key);
                  return (
                    <div key={axis.key} className="print-axis-section">
                      <h3 className="print-subheader">{axis.label}</h3>
                      {axisQuestions.map(q => {
                        const answer = CHOICES.find(c => c.value === answers[q.id]);
                        return (
                          <div key={q.id} className="print-question">
                            <p className="print-text">
                              <strong>{q.id}</strong> : {q.text}
                            </p>
                            <p className="print-text" style={{paddingLeft: '16px', color: '#4b5563'}}>
                              → Réponse : <strong>{answer?.label || 'Non répondu'}</strong> ({answer?.anchor || ''})
                            </p>
                          </div>
                        );
                      })}
                    </div>
                  );
                })}
              </div>

              <div className="print-section" style={{marginTop: '20px', paddingTop: '12px', borderTop: '1px solid #e2e8f0'}}>
                <p className="print-text" style={{fontSize: '10px', color: '#64748b'}}>
                  NOÉSIS — Trauma Bonding v1.0 • © 2025 • Outil de pré-diagnostic d'orientation, ne remplace pas un diagnostic médical
                </p>
              </div>
            </div>
          </div>
        </div>
      );
    }

    // ============================================================
    // RENDU DANS LE DOM
    // ============================================================

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<TraumaBondingTest />);
  </script>
</body>
</html>
