<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- SEO -->
  <title>Parentalité Toxique & Reconstruction — Auto-test NOÉSIS</title>
  <meta name="description" content="Grille d'évaluation clinique (60 items) pour évaluer l'empreinte de dynamiques parentales toxiques et le niveau de reconstruction. 6 axes validés.">
  
  <!-- Open Graph -->
  <meta property="og:title" content="Parentalité Toxique & Reconstruction — NOÉSIS">
  <meta property="og:description" content="Test clinique 60 questions. Évaluation reconstruction après parentalité toxique.">
  <meta property="og:type" content="website">
  
  <!-- Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- React + ReactDOM via CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- Babel Standalone pour JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <style>
    /* Styles d'impression PDF optimisés A4 */
    @media print {
      .no-print { display: none !important; }
      .print-only { display: block !important; }
      
      body { 
        background: white !important;
        margin: 0;
        padding: 0;
      }
      
      @page {
        size: A4;
        margin: 12mm 15mm;
      }
      
      .print-container {
        max-width: 100%;
        padding: 0 !important;
        margin: 0 !important;
      }
      
      .print-section {
        padding: 8px 0 !important;
        margin-bottom: 12px !important;
      }
      
      .print-header {
        font-size: 18px !important;
        margin-bottom: 8px !important;
        padding-bottom: 4px !important;
        border-bottom: 2px solid #334155;
      }
      
      .print-subheader {
        font-size: 14px !important;
        margin: 8px 0 4px 0 !important;
      }
      
      .print-text {
        font-size: 11px !important;
        line-height: 1.4 !important;
        margin: 2px 0 !important;
      }
      
      .print-question {
        font-size: 11px !important;
        padding: 3px 0 !important;
        page-break-inside: avoid;
      }
      
      .print-axis-section {
        page-break-inside: avoid;
        margin-bottom: 10px !important;
      }
      
      .print-score-box {
        padding: 6px !important;
        margin: 4px 0 !important;
        border: 1px solid #e2e8f0;
        border-radius: 4px;
      }
      
      .print-reco {
        font-size: 11px !important;
        padding: 2px 0 2px 16px !important;
        margin: 2px 0 !important;
      }
    }
    
    .print-only {
      display: none;
    }
  </style>
</head>
<body class="m-0 p-0">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useMemo, useCallback } = React;

    // ============================================================
    // CONFIGURATION
    // ============================================================

    const AXES = [
      { 
        key: "control", 
        label: "Contrôle & invalidation parentale", 
        color: "rose",
        description: "Manipulation, dénigrement, infantilisation, contrôle coercitif"
      },
      { 
        key: "climate", 
        label: "Climat émotionnel familial", 
        color: "fuchsia",
        description: "Imprévisibilité, amour conditionnel, honte, tabous"
      },
      { 
        key: "attach", 
        label: "Attachement & différenciation", 
        color: "amber",
        description: "Capacité à se séparer sans culpabilité, autonomie émotionnelle"
      },
      { 
        key: "self", 
        label: "Auto-perception & honte intériorisée", 
        color: "orange",
        description: "Estime de soi, voix critique interne, légitimité"
      },
      { 
        key: "trauma", 
        label: "Régulation & mémoire du trauma", 
        color: "purple",
        description: "Flashbacks, triggers, hypervigilance, réponses adaptatives"
      },
      { 
        key: "reparent", 
        label: "Résilience & reparentage", 
        color: "emerald",
        description: "Soutien, thérapie, construction de soi, rituels protecteurs"
      }
    ];

    const CHOICES = [
      { value: 0, label: "Jamais", anchor: "0 fois / 6 mois" },
      { value: 1, label: "Parfois", anchor: "1-3× / mois" },
      { value: 2, label: "Souvent", anchor: "1-3× / semaine" },
      { value: 3, label: "Très souvent", anchor: "Quasi quotidien" }
    ];

    const QUESTIONS = [
      // Contrôle & invalidation parentale (10)
      {id:"Q1", dim:"control", text:"Mes émotions étaient tournées en dérision ou jugées 'exagérées'."},
      {id:"Q2", dim:"control", text:"On me culpabilisait lorsque j'exprimais un besoin ou un désaccord."},
      {id:"Q3", dim:"control", text:"Les règles changeaient selon l'humeur, puis j'étais blâmé·e."},
      {id:"Q4", dim:"control", text:"On réécrivait les faits ('tu inventes', 'tu dramatises')."},
      {id:"Q5", dim:"control", text:"On me comparait défavorablement à un frère/sœur/autre enfant."},
      {id:"Q6", dim:"control", text:"Mes succès étaient minimisés ou attribués à la chance."},
      {id:"Q7", dim:"control", text:"L'intimité (lectures, téléphone, chambre) n'était pas respectée."},
      {id:"Q8", dim:"control", text:"Un parent disait 'c'est pour ton bien' en imposant un contrôle strict."},
      {id:"Q9", dim:"control", text:"On m'a fait jouer un rôle de confident·e/parent de substitution."},
      {id:"Q10", dim:"control", text:"On me demandait de 'sauver l'honneur' ou de taire certains faits."},
      
      // Climat émotionnel familial (10)
      {id:"Q11", dim:"climate", text:"Le climat était imprévisible (colères, silences, froid)."},
      {id:"Q12", dim:"climate", text:"L'amour/affection dépendaient de mes performances ou obéissance."},
      {id:"Q13", dim:"climate", text:"Les conflits n'étaient pas réparés (pas d'excuse, pas de réparation)."},
      {id:"Q14", dim:"climate", text:"Les sujets 'tabous' empêchaient d'aborder des problèmes réels."},
      {id:"Q15", dim:"climate", text:"L'alcool, l'addiction ou la maladie mentale ont rythmé l'ambiance."},
      {id:"Q16", dim:"climate", text:"J'évitais la maison ou certains moments par peur de réactions."},
      {id:"Q17", dim:"climate", text:"La honte publique (moqueries, humiliations) faisait partie du quotidien."},
      {id:"Q18", dim:"climate", text:"Le parent 'sympa' désavouait l'autre, me mettant au milieu."},
      {id:"Q19", dim:"climate", text:"Les rôles étaient inversés (je gérais les émotions d'un parent)."},
      {id:"Q20", dim:"climate", text:"Les besoins de l'enfant passaient après l'image de la famille."},
      
      // Attachement & différenciation (10)
      {id:"Q21", dim:"attach", text:"Je peux poser des limites à mes parents sans panique majeure."},
      {id:"Q22", dim:"attach", text:"Je me sens légitime à choisir ma vie même s'ils désapprouvent."},
      {id:"Q23", dim:"attach", text:"Je reconnais leurs qualités sans nier mes blessures."},
      {id:"Q24", dim:"attach", text:"Je tolère la culpabilité ou la déception de l'autre sans me renier."},
      {id:"Q25", dim:"attach", text:"Je sais couper un échange quand il devient maltraitant."},
      {id:"Q26", dim:"attach", text:"Je demande de l'aide extérieure si la relation me fait chuter."},
      {id:"Q27", dim:"attach", text:"Je prends du recul face aux injonctions familiales ('tu devrais')."},
      {id:"Q28", dim:"attach", text:"Je construis ma propre tradition/rythme sans anxiété excessive."},
      {id:"Q29", dim:"attach", text:"Je distingue loyauté familiale et loyauté envers moi-même."},
      {id:"Q30", dim:"attach", text:"Je peux aimer sans me sacrifier systématiquement."},
      
      // Auto-perception & honte intériorisée (10)
      {id:"Q31", dim:"self", text:"Une voix interne me critique sévèrement pour la moindre erreur."},
      {id:"Q32", dim:"self", text:"Je me sens 'de trop', 'pas assez', ou coupable par défaut."},
      {id:"Q33", dim:"self", text:"Je redoute l'autorité et recherche inconsciemment l'approbation."},
      {id:"Q34", dim:"self", text:"Je minimise mes souffrances ('ce n'était pas si grave')."},
      {id:"Q35", dim:"self", text:"Je répète des schémas (couples, travail) qui me dévalorisent."},
      {id:"Q36", dim:"self", text:"J'ai honte de mes besoins et j'ai du mal à les nommer."},
      {id:"Q37", dim:"self", text:"Je prends la responsabilité émotionnelle des autres par réflexe."},
      {id:"Q38", dim:"self", text:"Je ressens un devoir de loyauté même quand c'est injuste."},
      {id:"Q39", dim:"self", text:"Je m'excuse souvent d'exister ou d'occuper de la place."},
      {id:"Q40", dim:"self", text:"Je me sens imposteur·rice dans les espaces de réussite."},
      
      // Régulation & mémoire du trauma (10)
      {id:"Q41", dim:"trauma", text:"Je fais des flashbacks/ruminations après échanges familiaux."},
      {id:"Q42", dim:"trauma", text:"Mon sommeil/appétit/humeur changent après contacts parentaux."},
      {id:"Q43", dim:"trauma", text:"Je me mets en hypervigilance (anticipation, tension corporelle)."},
      {id:"Q44", dim:"trauma", text:"Je me sens dissocié·e (flou, temps perdu) après conflits familiaux."},
      {id:"Q45", dim:"trauma", text:"Je relis/édite mes messages par peur de déclencher une crise."},
      {id:"Q46", dim:"trauma", text:"Je ressens un soulagement physique à distance de la famille."},
      {id:"Q47", dim:"trauma", text:"Je rationalise l'inacceptable pour éviter l'explosion."},
      {id:"Q48", dim:"trauma", text:"Je fais 'fawn' (apaiser, plaire) pour survivre aux échanges."},
      {id:"Q49", dim:"trauma", text:"Je revis les scènes anciennes comme si elles étaient actuelles."},
      {id:"Q50", dim:"trauma", text:"Mon corps porte tensions, douleurs, maladies sans cause médicale."},
      
      // Résilience & reparentage (10)
      {id:"Q51", dim:"reparent", text:"Je consulte un·e thérapeute ou un·e professionnel·le formé·e."},
      {id:"Q52", dim:"reparent", text:"J'ai lu des livres sur trauma, attachement, parentalité toxique."},
      {id:"Q53", dim:"reparent", text:"Je note, journal ou documente mes ressentis pour y voir clair."},
      {id:"Q54", dim:"reparent", text:"Je pratique des rituels de régulation (méditation, mouvement, art)."},
      {id:"Q55", dim:"reparent", text:"Je m'entoure de personnes stables qui m'écoutent sans juger."},
      {id:"Q56", dim:"reparent", text:"Je reconnais les patterns toxiques et y résiste activement."},
      {id:"Q57", dim:"reparent", text:"Je m'accorde compassion et douceur face à mes failles."},
      {id:"Q58", dim:"reparent", text:"Je me permets de dire non et de protéger mon énergie."},
      {id:"Q59", dim:"reparent", text:"Je construis ma propre définition de famille (choisie ou restreinte)."},
      {id:"Q60", dim:"reparent", text:"Je célèbre mes petites victoires de reconstruction."}
    ];

    // ============================================================
    // FONCTIONS DE SCORING
    // ============================================================

    function scoreBands(total, perAxis) {
      if (total <= 60) {
        return {
          band: "Sécurité émotionnelle intégrée",
          color: "green",
          severity: "none",
          message: "Vos scores révèlent des modèles parentaux globalement stables et sécurisants. Les dynamiques familiales décrites témoignent d'un attachement suffisamment bon, permettant autonomie et différenciation sans culpabilité majeure. Les traces d'imperfections parentales restent dans des proportions normatives.",
          recommendations: [
            "Continuer à cultiver la différenciation saine entre vos besoins et ceux de votre famille d'origine.",
            "Maintenir une communication authentique avec vos parents si elle est possible et non toxique.",
            "Transmettre les ressources internes construites dans vos relations actuelles (couple, parentalité, amitié)."
          ]
        };
      }
      
      if (total <= 100) {
        return {
          band: "Traces résiduelles",
          color: "yellow",
          severity: "low",
          message: "Vos résultats indiquent un héritage de schémas critiques ou d'invalidations émotionnelles partiellement intégrés. Certaines dynamiques parentales ont laissé des empreintes (voix critique, quête d'approbation, hypervigilance modérée), mais vous disposez de ressources de reconstruction significatives.",
          recommendations: [
            "Accompagnement psychologique léger (coaching, thérapie brève orientée solution) pour consolider la différenciation.",
            "Journaling régulier pour identifier les schémas automatiques (voix critique, culpabilité non fondée).",
            "Pratiques de régulation corporelle (respiration, yoga, méditation) pour apaiser l'hypervigilance résiduelle.",
            "Lectures ciblées : Alice Miller (Le Drame de l'enfant doué), Susan Forward (Parents toxiques).",
            "Renforcer le réseau de soutien : entourage stable, groupe de parole, mentors bienveillants."
          ]
        };
      }
      
      if (total <= 140) {
        return {
          band: "Empreinte significative",
          color: "orange",
          severity: "moderate",
          message: "Vos scores révèlent une exposition à des dynamiques familiales toxiques structurantes. Les mécanismes de contrôle, d'invalidation émotionnelle et d'attachement insécure ont généré des schémas d'auto-dévalorisation, d'hypervigilance et de culpabilité chronique. Vous êtes en phase de reconstruction active, mais les empreintes restent profondes.",
          recommendations: [
            "PRIORITÉ : Psychothérapie spécialisée trauma/attachement (EMDR, IFS, thérapie relationnelle). Chercher thérapeute formé trauma complexe.",
            "Documenter les patterns toxiques : liste concrète des comportements parentaux problématiques, impacts observables sur votre vie actuelle.",
            "Travail sur les croyances limitantes : identifier la voix critique internalisée, distinguer 'ce qu'on m'a dit' vs 'qui je suis réellement'.",
            "Pratiques de reparentage : lettre à soi enfant, visualisations protectrices, rituels de validation émotionnelle.",
            "Poser des limites concrètes : réduire fréquence/durée des contacts si nécessaire, privilégier écrit sur oral, couper si maltraitance active.",
            "Ressources spécialisées : Association STOP VOG (violences éducatives), groupes thérapeutiques enfants de parents toxiques.",
            "Lectures : Jonice Webb (Trauma invisible), Pete Walker (CPTSD), Richard Schwartz (No Bad Parts)."
          ]
        };
      }
      
      return {
        band: "Trauma complexe actif",
        color: "red",
        severity: "critical",
        message: "Vos résultats témoignent d'un trauma complexe relationnel sévère. L'exposition prolongée à des dynamiques parentales toxiques (contrôle coercitif, invalidation chronique, climat imprévisible) a généré des altérations profondes : estime de soi effondrée, hypervigilance permanente, dissociation, répétition de schémas maltraitants. Vous êtes en souffrance majeure nécessitant un accompagnement pluridisciplinaire immédiat.",
        recommendations: [
          "URGENCE : Consultation psychiatre/psychotraumatologue dans les 7 jours. Évaluation état dépressif, anxiété généralisée, TSPT complexe.",
          "Arrêt ou réduction drastique des contacts familiaux si maintien génère décompensation (idées noires, dissociation sévère, auto-mutilation).",
          "Psychothérapie intensive spécialisée trauma complexe : EMDR phases 1-2, IFS (Internal Family Systems), thérapie relationnelle sensori-motrice.",
          "Médication si nécessaire : antidépresseurs (ISRS), anxiolytiques court terme, régulation sommeil sous supervision médicale.",
          "Hospitalisation de jour ou CMP si décompensation sévère (idées suicidaires actives, incapacité fonctionnelle majeure).",
          "Protocole de régulation intensive : cohérence cardiaque quotidienne, yoga trauma-sensible, art-thérapie, EMDR bilaterale.",
          "Soutien social renforcé : informer proches de confiance, association d'entraide (STOP VOG, SOS Victimes), groupe thérapeutique.",
          "Documentation juridique si maltraitance continue : signalement, main courante, protection juridique.",
          "Numéros d'urgence : 3114 (prévention suicide), 119 (enfance en danger si mineurs dans famille), 116 006 (victimes).",
          "Lectures validation : Pete Walker (Complex PTSD), Laurence Dispaux (Se reconstruire après maltraitance), Alice Miller (C'est pour ton bien)."
        ]
      };
    }

    function getAxisAnalysis(dimScores) {
      const sorted = Object.entries(dimScores)
        .map(([key, score]) => ({ key, score, dim: AXES.find(d => d.key === key) }))
        .sort((a, b) => b.score - a.score);
      
      const dominant = sorted[0];
      
      const analyses = {
        control: "Le contrôle et l'invalidation parentale dominent votre profil. Vous avez probablement grandi dans un environnement où vos émotions étaient systématiquement niées, vos choix remis en cause et votre autonomie réprimée. Cette empreinte génère aujourd'hui une difficulté à vous faire confiance et à affirmer vos limites.",
        climate: "Le climat émotionnel imprévisible est votre dimension dominante. L'instabilité affective, l'amour conditionnel et l'imprévisibilité parentale ont créé un état d'hypervigilance chronique. Vous anticipez constamment les réactions de l'autre et marchez sur des œufs dans vos relations actuelles.",
        attach: "L'attachement et la différenciation sont vos points forts. Malgré les difficultés passées, vous avez développé une capacité à poser des limites, à vous différencier de votre famille d'origine et à construire votre propre vie sans culpabilité paralysante. Cette autonomie émotionnelle est un facteur protecteur majeur.",
        self: "L'auto-perception et la honte intériorisée dominent votre profil. La voix critique parentale s'est intériorisée en un juge interne sévère qui dévalorise systématiquement vos choix, vos besoins et votre légitimité. Cette honte toxique empoisonne votre estime de soi et génère un sentiment chronique d'imposture.",
        trauma: "La régulation et la mémoire du trauma sont au cœur de votre souffrance actuelle. Votre système nerveux porte encore les traces de l'exposition chronique au stress familial : flashbacks, hypervigilance, réponses de survie (fawn, freeze), dissociation. Votre corps témoigne d'un trauma non résolu.",
        reparent: "La résilience et le reparentage sont vos ressources dominantes. Vous avez activement entrepris un travail de reconstruction : thérapie, lectures, pratiques de régulation, entourage choisi. Cette capacité à vous reparenter et à chercher du soutien est le fondement de votre guérison."
      };
      
      return {
        dominant: dominant.key,
        analysis: analyses[dominant.key]
      };
    }

    // ============================================================
    // COMPOSANT PRINCIPAL
    // ============================================================

    function ParentaliteTest() {
      const [page, setPage] = useState("intro");
      const [currentQ, setCurrentQ] = useState(0);
      const [answers, setAnswers] = useState({});
      const [email, setEmail] = useState("");

      // SUPPRESSION TOTALE localStorage — Test toujours vierge

      const allAnswered = Object.keys(answers).length === QUESTIONS.length;

      const handleAnswer = useCallback((qId, value) => {
        setAnswers(prev => ({ ...prev, [qId]: value }));
        
        if (currentQ < QUESTIONS.length - 1) {
          setTimeout(() => setCurrentQ(c => c + 1), 150);
        }
      }, [currentQ]);

      const goToResults = useCallback(() => {
        if (!allAnswered) {
          alert(`Il reste ${QUESTIONS.length - Object.keys(answers).length} question(s) sans réponse.`);
          return;
        }
        setPage("results");
      }, [allAnswered, answers]);

      const reset = useCallback(() => {
        setAnswers({});
        setCurrentQ(0);
        setPage("intro");
        setEmail("");
      }, []);

      const dimensionScores = useMemo(() => {
        const scores = {};
        AXES.forEach(axis => {
          const qs = QUESTIONS.filter(q => q.dim === axis.key);
          const total = qs.reduce((sum, q) => sum + (answers[q.id] || 0), 0);
          scores[axis.key] = total;
        });
        return scores;
      }, [answers]);

      const totalScore = useMemo(() => {
        return Object.values(dimensionScores).reduce((a, b) => a + b, 0);
      }, [dimensionScores]);

      const resultBand = useMemo(() => scoreBands(totalScore, dimensionScores), [totalScore, dimensionScores]);
      const profileAnalysis = useMemo(() => getAxisAnalysis(dimensionScores), [dimensionScores]);

      const handlePDF = useCallback(() => {
        window.print();
      }, []);

      const handleDownloadJSON = useCallback(() => {
        const data = {
          test: "Parentalité Toxique & Reconstruction",
          date: new Date().toISOString(),
          totalScore,
          resultBand: resultBand.band,
          dimensionScores,
          answers: QUESTIONS.map(q => ({
            id: q.id,
            dimension: q.dim,
            question: q.text,
            answer: CHOICES.find(c => c.value === answers[q.id])?.label || "Non répondu"
          }))
        };
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `noesis-parentalite-${new Date().toISOString().split('T')[0]}.json`;
        a.click();
        URL.revokeObjectURL(url);
      }, [totalScore, resultBand, dimensionScores, answers]);

      const handleEmail = useCallback(() => {
        if (!email) return;
        const subject = encodeURIComponent("Résultats Auto-test Parentalité Toxique");
        const body = encodeURIComponent(
          `Bonjour,\n\nVoici mes résultats au test Parentalité Toxique NOÉSIS :\n\n` +
          `Score total : ${totalScore}/180\n` +
          `Profil : ${resultBand.band}\n\n` +
          `Scores par dimension :\n` +
          AXES.map(d => `- ${d.label} : ${dimensionScores[d.key]}`).join('\n') +
          `\n\nPour consulter le détail complet, merci de télécharger le PDF ou JSON depuis le site.`
        );
        window.location.href = `mailto:${email}?subject=${subject}&body=${body}`;
      }, [email, totalScore, resultBand, dimensionScores]);

      const progress = useMemo(() => Math.round((currentQ / QUESTIONS.length) * 100), [currentQ]);

      // ============================================================
      // PAGE INTRO
      // ============================================================
      
      if (page === "intro") {
        return (
          <div className="min-h-screen bg-gradient-to-br from-slate-50 via-indigo-50 to-purple-50 p-4 md:p-8">
            <div className="max-w-3xl mx-auto">
              <div className="text-center mb-8">
                <div className="inline-block p-4 bg-indigo-100 rounded-2xl mb-4">
                  <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="text-indigo-600">
                    <path d="M9.5 2c-1.82 0-3.53.5-5 1.36C2.68 4.72 1.5 6.73 1.5 9c0 1.56.52 3 1.39 4.14.87 1.14 2.07 2 3.43 2.36"/>
                    <path d="M14.5 2c1.82 0 3.53.5 5 1.36C21.32 4.72 22.5 6.73 22.5 9c0 1.56-.52 3-1.39 4.14-.87 1.14-2.07 2-3.43 2.36"/>
                    <path d="M12 2v20"/>
                    <path d="M9.5 15.5c0 1.38.62 2.5 1.5 2.5"/>
                    <path d="M14.5 15.5c0 1.38-.62 2.5-1.5 2.5"/>
                    <circle cx="9" cy="9" r="1" fill="currentColor"/>
                    <circle cx="15" cy="9" r="1" fill="currentColor"/>
                  </svg>
                </div>
                <h1 className="text-4xl md:text-5xl font-black text-slate-900 mb-3">
                  Parentalité Toxique & Reconstruction
                </h1>
                <p className="text-lg text-slate-600 font-medium">
                  Grille d'évaluation clinique — 60 items validés
                </p>
              </div>

              <div className="bg-white rounded-2xl shadow-2xl p-6 md:p-8 mb-6">
                <div className="bg-amber-50 border-l-4 border-amber-500 p-4 mb-6 rounded-r-lg">
                  <div className="flex gap-3">
                    <span className="text-2xl flex-shrink-0">⚠️</span>
                    <div className="text-sm text-amber-900">
                      <p className="font-bold mb-1">Avertissement méthodologique</p>
                      <p className="leading-relaxed">
                        Cette grille d'évaluation clinique <strong>ne remplace pas un diagnostic professionnel</strong>. 
                        Elle vise à identifier l'empreinte de dynamiques parentales toxiques et le niveau de reconstruction. 
                        En cas de scores élevés, un accompagnement psychothérapeutique spécialisé est fortement recommandé.
                      </p>
                    </div>
                  </div>
                </div>

                <div className="mb-8">
                  <div className="flex items-center gap-2 mb-4">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="text-slate-700">
                      <circle cx="11" cy="11" r="8"/>
                      <path d="m21 21-4.35-4.35"/>
                      <circle cx="11" cy="11" r="3"/>
                    </svg>
                    <h2 className="text-xl font-bold text-slate-900">Méthodologie</h2>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-3 mb-6">
                    <div className="bg-rose-50 text-rose-700 px-3 py-2 rounded-lg text-center text-sm font-semibold">
                      Contrôle & invalidation
                    </div>
                    <div className="bg-fuchsia-50 text-fuchsia-700 px-3 py-2 rounded-lg text-center text-sm font-semibold">
                      Climat émotionnel
                    </div>
                    <div className="bg-amber-50 text-amber-700 px-3 py-2 rounded-lg text-center text-sm font-semibold">
                      Attachement
                    </div>
                    <div className="bg-orange-50 text-orange-700 px-3 py-2 rounded-lg text-center text-sm font-semibold">
                      Auto-perception
                    </div>
                    <div className="bg-purple-50 text-purple-700 px-3 py-2 rounded-lg text-center text-sm font-semibold">
                      Trauma & régulation
                    </div>
                    <div className="bg-emerald-50 text-emerald-700 px-3 py-2 rounded-lg text-center text-sm font-semibold">
                      Résilience
                    </div>
                  </div>

                  <div className="prose prose-sm text-slate-700 space-y-3">
                    <p className="leading-relaxed">
                      Cette grille évalue <strong>six dimensions de l'empreinte parentale toxique et de la reconstruction</strong> : 
                      contrôle et invalidation, climat émotionnel, capacité d'attachement sain, auto-perception et honte, 
                      régulation du trauma et ressources de reparentage. Évaluation rétrospective et actuelle.
                    </p>
                  </div>
                </div>

                <div className="grid md:grid-cols-3 gap-4 mb-8">
                  <div className="bg-slate-50 p-4 rounded-xl text-center">
                    <div className="flex justify-center mb-2">
                      <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="text-indigo-600">
                        <circle cx="12" cy="13" r="9"/>
                        <polyline points="12 7 12 13 15 15"/>
                        <path d="M10 2h4"/>
                      </svg>
                    </div>
                    <div className="text-2xl font-bold text-slate-900">18-24 min</div>
                    <div className="text-sm text-slate-600">Durée estimée</div>
                  </div>
                  <div className="bg-slate-50 p-4 rounded-xl text-center">
                    <div className="flex justify-center mb-2">
                      <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="text-indigo-600">
                        <line x1="18" y1="20" x2="18" y2="10"/>
                        <line x1="12" y1="20" x2="12" y2="4"/>
                        <line x1="6" y1="20" x2="6" y2="14"/>
                      </svg>
                    </div>
                    <div className="text-2xl font-bold text-slate-900">60 questions</div>
                    <div className="text-sm text-slate-600">Grille clinique</div>
                  </div>
                  <div className="bg-slate-50 p-4 rounded-xl text-center">
                    <div className="flex justify-center mb-2">
                      <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="text-indigo-600">
                        <path d="M3 3v18h18"/>
                        <path d="M18 9l-5 5-4-4-4 4"/>
                        <circle cx="18" cy="9" r="2" fill="currentColor"/>
                        <circle cx="13" cy="14" r="2" fill="currentColor"/>
                        <circle cx="9" cy="10" r="2" fill="currentColor"/>
                        <circle cx="5" cy="14" r="2" fill="currentColor"/>
                      </svg>
                    </div>
                    <div className="text-2xl font-bold text-slate-900">6 dimensions</div>
                    <div className="text-sm text-slate-600">Analyse multi-axes</div>
                  </div>
                </div>

                <button
                  onClick={() => setPage("test")}
                  className="w-full bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white text-lg font-bold py-4 px-6 rounded-xl transition-all shadow-lg hover:shadow-xl"
                >
                  Commencer l'évaluation →
                </button>
              </div>

              <div className="text-center text-xs text-slate-500 space-y-1">
                <p className="font-semibold">NOÉSIS — Parentalité Toxique v1.0 • © 2025</p>
                <p>Confidentialité : aucune donnée collectée sans action explicite (RGPD)</p>
              </div>
            </div>
          </div>
        );
      }

      // ============================================================
      // PAGE TEST
      // ============================================================

      if (page === "test") {
        const q = QUESTIONS[currentQ];
        const dimInfo = AXES.find(d => d.key === q.dim);
        const colorMap = {
          rose: { bg: "bg-rose-50", border: "border-rose-300", text: "text-rose-700", badge: "bg-rose-100 text-rose-700" },
          fuchsia: { bg: "bg-fuchsia-50", border: "border-fuchsia-300", text: "text-fuchsia-700", badge: "bg-fuchsia-100 text-fuchsia-700" },
          amber: { bg: "bg-amber-50", border: "border-amber-300", text: "text-amber-700", badge: "bg-amber-100 text-amber-700" },
          orange: { bg: "bg-orange-50", border: "border-orange-300", text: "text-orange-700", badge: "bg-orange-100 text-orange-700" },
          purple: { bg: "bg-purple-50", border: "border-purple-300", text: "text-purple-700", badge: "bg-purple-100 text-purple-700" },
          emerald: { bg: "bg-emerald-50", border: "border-emerald-300", text: "text-emerald-700", badge: "bg-emerald-100 text-emerald-700" },
        };
        const colors = colorMap[dimInfo.color];

        return (
          <div className="min-h-screen bg-gradient-to-br from-slate-50 via-indigo-50 to-purple-50 p-4 md:p-8">
            <div className="max-w-3xl mx-auto">
              
              <div className="mb-6">
                <div className="flex justify-between items-center mb-2">
                  <span className="text-sm font-medium text-slate-600">
                    Question {currentQ + 1} / {QUESTIONS.length}
                  </span>
                  <span className="text-sm font-bold text-indigo-600">{progress}%</span>
                </div>
                <div className="w-full bg-slate-200 rounded-full h-3 overflow-hidden">
                  <div 
                    className="h-full bg-gradient-to-r from-indigo-500 to-purple-500 transition-all duration-300"
                    style={{ width: `${progress}%` }}
                  />
                </div>
              </div>

              <div className="bg-white rounded-2xl shadow-2xl p-6 md:p-8 mb-6">
                <div className="flex items-center gap-3 mb-6">
                  <div className={`w-12 h-12 rounded-full ${colors.bg} ${colors.border} border-2 flex items-center justify-center font-bold ${colors.text} text-lg`}>
                    {currentQ + 1}
                  </div>
                  <span className={`px-3 py-1 rounded-full text-xs font-semibold ${colors.badge}`}>
                    {dimInfo.label}
                  </span>
                </div>

                <h2 className="text-xl md:text-2xl font-bold text-slate-900 mb-8 leading-relaxed">
                  {q.text}
                </h2>

                <div className="space-y-3">
                  {CHOICES.map(choice => {
                    const isSelected = answers[q.id] === choice.value;
                    return (
                      <button
                        key={choice.value}
                        onClick={() => handleAnswer(q.id, choice.value)}
                        className={`w-full text-left p-4 rounded-xl border-2 transition-all ${
                          isSelected
                            ? 'bg-indigo-50 border-indigo-500 shadow-lg'
                            : 'bg-white border-slate-200 hover:border-indigo-300 hover:bg-slate-50'
                        }`}
                      >
                        <div className="flex items-center justify-between">
                          <div>
                            <div className={`font-semibold mb-1 ${isSelected ? 'text-indigo-700' : 'text-slate-900'}`}>
                              {choice.label}
                            </div>
                            <div className="text-xs text-slate-500">{choice.anchor}</div>
                          </div>
                          <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center ${
                            isSelected ? 'bg-indigo-500 border-indigo-500' : 'border-slate-300'
                          }`}>
                            {isSelected && <span className="text-white text-xs font-bold">✓</span>}
                          </div>
                        </div>
                      </button>
                    );
                  })}
                </div>
              </div>

              <div className="flex gap-4">
                <button
                  onClick={() => setCurrentQ(c => Math.max(0, c - 1))}
                  disabled={currentQ === 0}
                  className="flex-1 bg-slate-200 hover:bg-slate-300 disabled:bg-slate-100 disabled:text-slate-400 text-slate-700 font-semibold py-3 px-6 rounded-xl transition"
                >
                  ← Précédent
                </button>
                
                {currentQ === QUESTIONS.length - 1 ? (
                  <button
                    onClick={goToResults}
                    disabled={!allAnswered}
                    className="flex-1 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 disabled:from-slate-300 disabled:to-slate-300 text-white font-bold py-3 px-6 rounded-xl transition-all shadow-lg"
                  >
                    Voir les résultats →
                  </button>
                ) : (
                  <button
                    onClick={() => setCurrentQ(c => Math.min(QUESTIONS.length - 1, c + 1))}
                    className="flex-1 bg-slate-700 hover:bg-slate-800 text-white font-semibold py-3 px-6 rounded-xl transition"
                  >
                    Suivant →
                  </button>
                )}
              </div>

              <div className="mt-4 text-center">
                <button
                  onClick={goToResults}
                  disabled={!allAnswered}
                  className="text-sm text-slate-500 hover:text-slate-700 underline disabled:text-slate-300"
                >
                  {allAnswered ? "Aller directement aux résultats" : `${QUESTIONS.length - Object.keys(answers).length} question(s) restante(s)`}
                </button>
              </div>
            </div>
          </div>
        );
      }

      // ============================================================
      // PAGE RÉSULTATS + SECTION IMPRIMABLE
      // ============================================================

      return (
        <div className="min-h-screen bg-gradient-to-br from-slate-50 via-indigo-50 to-purple-50 p-4 md:p-8">
          <div className="max-w-5xl mx-auto">
            
            {/* SECTION ÉCRAN */}
            <div className="no-print">
              <div className="text-center mb-8">
                <div className="inline-block p-4 bg-gradient-to-br from-indigo-100 to-purple-100 rounded-2xl mb-4">
                  <svg width="56" height="56" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="text-indigo-600">
                    <path d="M3 3v18h18"/>
                    <path d="M18 9l-5 5-4-4-4 4"/>
                    <circle cx="18" cy="9" r="2"/>
                    <circle cx="13" cy="14" r="2"/>
                    <circle cx="9" cy="10" r="2"/>
                    <circle cx="5" cy="14" r="2"/>
                  </svg>
                </div>
                <h1 className="text-4xl md:text-5xl font-black text-slate-900 mb-3">
                  Tes résultats
                </h1>
                <p className="text-lg text-slate-600 font-medium">
                  Analyse détaillée de ton empreinte et reconstruction
                </p>
              </div>

              <div className="bg-white rounded-2xl shadow-2xl p-6 md:p-8 mb-6">
                <div className="text-center mb-6">
                  <div className="text-6xl font-black text-slate-900 mb-2">
                    {totalScore}<span className="text-3xl text-slate-400">/180</span>
                  </div>
                  <div className={`inline-block px-6 py-2 rounded-full text-lg font-bold ${
                    resultBand.color === 'green' ? 'bg-green-100 text-green-700' :
                    resultBand.color === 'yellow' ? 'bg-yellow-100 text-yellow-700' :
                    resultBand.color === 'orange' ? 'bg-orange-100 text-orange-700' :
                    'bg-red-100 text-red-700'
                  }`}>
                    {resultBand.band}
                  </div>
                </div>

                <div className="bg-slate-50 p-6 rounded-2xl mb-6">
                  <h3 className="font-bold text-slate-900 mb-3">🔍 Interprétation clinique</h3>
                  <p className="text-sm text-slate-700 leading-relaxed">
                    {resultBand.message}
                  </p>
                </div>

                <div className="space-y-4 mb-6">
                  <h3 className="font-bold text-slate-900">Scores par dimension</h3>
                  {AXES.map(axis => {
                    const score = dimensionScores[axis.key];
                    const max = QUESTIONS.filter(q => q.dim === axis.key).length * 3;
                    const percentage = Math.round((score / max) * 100);
                    const colorMap = {
                      rose: { bg: "bg-rose-50", bar: "bg-rose-500", text: "text-rose-700" },
                      fuchsia: { bg: "bg-fuchsia-50", bar: "bg-fuchsia-500", text: "text-fuchsia-700" },
                      amber: { bg: "bg-amber-50", bar: "bg-amber-500", text: "text-amber-700" },
                      orange: { bg: "bg-orange-50", bar: "bg-orange-500", text: "text-orange-700" },
                      purple: { bg: "bg-purple-50", bar: "bg-purple-500", text: "text-purple-700" },
                      emerald: { bg: "bg-emerald-50", bar: "bg-emerald-500", text: "text-emerald-700" },
                    };
                    const colors = colorMap[axis.color];
                    
                    return (
                      <div key={axis.key} className={`p-4 rounded-xl ${colors.bg}`}>
                        <div className="flex justify-between items-center mb-2">
                          <span className={`text-sm font-bold ${colors.text}`}>{axis.label}</span>
                          <span className="text-sm font-bold text-slate-700">{score}/{max}</span>
                        </div>
                        <div className="w-full bg-white rounded-full h-3 overflow-hidden">
                          <div 
                            className={`h-full ${colors.bar} transition-all duration-500`}
                            style={{ width: `${percentage}%` }}
                          />
                        </div>
                        <div className="text-xs text-slate-600 mt-1">{percentage}%</div>
                      </div>
                    );
                  })}
                </div>

                <div className="bg-slate-50 p-6 rounded-2xl">
                  <h3 className="font-bold text-slate-900 mb-3">📌 Ton profil dominant</h3>
                  <p className="text-sm font-semibold text-indigo-600 mb-2">
                    {AXES.find(d => d.key === profileAnalysis.dominant)?.label}
                  </p>
                  <p className="text-sm text-slate-700 leading-relaxed">
                    {profileAnalysis.analysis}
                  </p>
                </div>
              </div>

              <div className="grid md:grid-cols-2 gap-6">
                
                <div className="bg-white rounded-2xl shadow-xl p-6">
                  <h2 className="text-xl font-bold text-slate-900 mb-4">Recommandations</h2>
                  <ul className="space-y-3">
                    {resultBand.recommendations.map((rec, idx) => (
                      <li key={idx} className="flex gap-3 text-sm text-slate-700">
                        <span className="flex-shrink-0 w-6 h-6 rounded-full bg-indigo-100 text-indigo-600 font-bold text-xs flex items-center justify-center">
                          {idx + 1}
                        </span>
                        <span>{rec}</span>
                      </li>
                    ))}
                  </ul>

                  {resultBand.severity === 'critical' && (
                    <div className="mt-6 pt-6 border-t-2 border-slate-100">
                      <h3 className="font-bold text-slate-900 mb-3">Ressources d'urgence</h3>
                      <ul className="space-y-2 text-sm">
                        <li>
                          <span className="text-slate-900 font-medium">3114</span>
                          <span className="text-slate-600"> — Prévention suicide</span>
                        </li>
                        <li>
                          <span className="text-slate-900 font-medium">116 006</span>
                          <span className="text-slate-600"> — Aide aux victimes</span>
                        </li>
                        <li>
                          <span className="text-slate-900 font-medium">STOP VOG</span>
                          <span className="text-slate-600"> — Association violence éducative</span>
                        </li>
                      </ul>
                    </div>
                  )}
                </div>

                <div className="bg-white rounded-2xl shadow-xl p-6">
                  <h2 className="text-xl font-bold text-slate-900 mb-4">Exporter les résultats</h2>
                  
                  <div className="space-y-3">
                    <button
                      onClick={handlePDF}
                      className="w-full bg-slate-900 text-white font-semibold py-3 px-4 rounded-xl hover:bg-slate-800 transition"
                    >
                      📄 Télécharger en PDF
                    </button>

                    <button
                      onClick={handleDownloadJSON}
                      className="w-full bg-slate-700 text-white font-semibold py-3 px-4 rounded-xl hover:bg-slate-600 transition"
                    >
                      💾 Télécharger en JSON
                    </button>

                    <div className="pt-4 border-t-2 border-slate-100">
                      <label className="block text-sm font-medium text-slate-700 mb-2">
                        Envoyer par email
                      </label>
                      <div className="flex gap-2">
                        <input
                          type="email"
                          value={email}
                          onChange={(e) => setEmail(e.target.value)}
                          placeholder="email@exemple.com"
                          className="flex-1 rounded-lg border-2 border-slate-300 px-3 py-2 text-sm focus:border-indigo-500 focus:outline-none"
                        />
                        <button
                          onClick={handleEmail}
                          disabled={!email}
                          className="bg-indigo-600 disabled:bg-slate-300 text-white font-semibold px-4 py-2 rounded-lg hover:bg-indigo-700 transition"
                        >
                          📧
                        </button>
                      </div>
                    </div>

                    <button
                      onClick={reset}
                      className="w-full mt-4 text-slate-600 hover:text-slate-900 font-medium underline text-sm"
                    >
                      Refaire le test
                    </button>
                  </div>
                </div>
              </div>

              <div className="mt-8 text-center text-xs text-slate-500 space-y-2">
                <p className="font-semibold">NOÉSIS — Parentalité Toxique v1.0 • © 2025</p>
                <p>Outil de pré-diagnostic d'orientation • Pas un diagnostic médical</p>
                <p>Confidentialité : aucune donnée collectée sans action explicite (RGPD)</p>
              </div>
            </div>

            {/* SECTION IMPRIMABLE PDF (cachée à l'écran) */}
            <div className="print-only print-container">
              <div className="print-section">
                <h1 className="print-header">Résultats — Parentalité Toxique & Reconstruction</h1>
                <p className="print-text">Date : {new Date().toLocaleDateString('fr-FR')}</p>
                <p className="print-text">Score total : <strong>{totalScore}/180</strong></p>
                <p className="print-text">Profil : <strong>{resultBand.band}</strong></p>
              </div>

              <div className="print-section">
                <h2 className="print-subheader">Interprétation clinique</h2>
                <p className="print-text">{resultBand.message}</p>
              </div>

              <div className="print-section">
                <h2 className="print-subheader">Scores par dimension</h2>
                {AXES.map(axis => {
                  const score = dimensionScores[axis.key];
                  const max = QUESTIONS.filter(q => q.dim === axis.key).length * 3;
                  const percentage = Math.round((score / max) * 100);
                  return (
                    <div key={axis.key} className="print-score-box">
                      <p className="print-text"><strong>{axis.label}</strong> : {score}/{max} ({percentage}%)</p>
                    </div>
                  );
                })}
              </div>

              <div className="print-section">
                <h2 className="print-subheader">Profil dominant</h2>
                <p className="print-text"><strong>{AXES.find(d => d.key === profileAnalysis.dominant)?.label}</strong></p>
                <p className="print-text">{profileAnalysis.analysis}</p>
              </div>

              <div className="print-section">
                <h2 className="print-subheader">Recommandations</h2>
                {resultBand.recommendations.map((rec, idx) => (
                  <p key={idx} className="print-reco">{idx + 1}. {rec}</p>
                ))}
              </div>

              {/* DÉTAIL COMPLET DES QUESTIONS PAR AXE */}
              <div className="print-section" style={{pageBreakBefore: 'always'}}>
                <h2 className="print-header">Détail des réponses par dimension</h2>
                
                {AXES.map(axis => {
                  const axisQuestions = QUESTIONS.filter(q => q.dim === axis.key);
                  return (
                    <div key={axis.key} className="print-axis-section">
                      <h3 className="print-subheader">{axis.label}</h3>
                      {axisQuestions.map(q => {
                        const answer = CHOICES.find(c => c.value === answers[q.id]);
                        return (
                          <div key={q.id} className="print-question">
                            <p className="print-text">
                              <strong>{q.id}</strong> : {q.text}
                            </p>
                            <p className="print-text" style={{paddingLeft: '16px', color: '#4b5563'}}>
                              → Réponse : <strong>{answer?.label || 'Non répondu'}</strong> ({answer?.anchor || ''})
                            </p>
                          </div>
                        );
                      })}
                    </div>
                  );
                })}
              </div>

              <div className="print-section" style={{marginTop: '20px', paddingTop: '12px', borderTop: '1px solid #e2e8f0'}}>
                <p className="print-text" style={{fontSize: '10px', color: '#64748b'}}>
                  NOÉSIS — Parentalité Toxique v1.0 • © 2025 • Outil de pré-diagnostic d'orientation, ne remplace pas un diagnostic médical
                </p>
              </div>
            </div>
          </div>
        </div>
      );
    }

    // ============================================================
    // RENDU DANS LE DOM
    // ============================================================

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<ParentaliteTest />);
  </script>
</body>
</html>
