<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- SEO -->
  <title>Auto-test TDAH — Pré-diagnostic en ligne | Noesis</title>
  <meta name="description" content="Test TDAH adulte gratuit en 10-15 minutes. Outil de pré-diagnostic basé sur DSM-5 et ASRS. Analyse détaillée et recommandations personnalisées.">
  
  <!-- Open Graph -->
  <meta property="og:title" content="Auto-test TDAH — Noesis">
  <meta property="og:description" content="Test TDAH adulte gratuit, sérieux et moderne. 50 questions cliniques, résultats instantanés.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://noesisanalyse.netlify.app/outils/test-tdah.html">
  
  <!-- Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- React + ReactDOM via CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- Babel Standalone pour JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <style>
    /* Styles d'impression PDF optimisés A4 */
    @media print {
      .no-print { display: none !important; }
      .print-only { display: block !important; }
      
      body { 
        background: white !important;
        margin: 0;
        padding: 0;
      }
      
      @page {
        size: A4;
        margin: 12mm 15mm;
      }
      
      .print-container {
        max-width: 100%;
        padding: 0 !important;
        margin: 0 !important;
      }
      
      .print-section {
        padding: 8px 0 !important;
        margin-bottom: 12px !important;
      }
      
      .print-header {
        font-size: 18px !important;
        margin-bottom: 8px !important;
        padding-bottom: 4px !important;
        border-bottom: 2px solid #334155;
      }
      
      .print-subheader {
        font-size: 14px !important;
        margin: 8px 0 4px 0 !important;
      }
      
      .print-text {
        font-size: 11px !important;
        line-height: 1.4 !important;
        margin: 2px 0 !important;
      }
      
      .print-question {
        font-size: 11px !important;
        padding: 3px 0 !important;
        page-break-inside: avoid;
      }
      
      .print-axis-section {
        page-break-inside: avoid;
        margin-bottom: 10px !important;
      }
      
      .print-score-box {
        padding: 6px !important;
        margin: 4px 0 !important;
        border: 1px solid #e2e8f0;
        border-radius: 4px;
      }
      
      .print-reco {
        font-size: 11px !important;
        padding: 2px 0 2px 16px !important;
        margin: 2px 0 !important;
      }
    }
    
    .print-only {
      display: none;
    }
  </style>
</head>
<body class="m-0 p-0">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useMemo, useCallback, useEffect } = React;

    // ============================================================
    // CONFIGURATION
    // ============================================================

    const DIMENSIONS = [
      { key: "inattention", label: "Inattention", color: "amber" },
      { key: "hyperactivite", label: "Hyperactivité", color: "sky" },
      { key: "impulsivite", label: "Impulsivité", color: "rose" },
      { key: "emotion", label: "Régulation émotionnelle", color: "emerald" },
    ];

    const CHOICES = [
      { value: 0, label: "Jamais", anchor: "Ne me correspond pas" },
      { value: 1, label: "Rarement", anchor: "< 1×/semaine" },
      { value: 2, label: "Parfois", anchor: "1-2×/semaine" },
      { value: 3, label: "Souvent", anchor: "3-5×/semaine" },
      { value: 4, label: "Très souvent", anchor: "Quasi quotidien" },
    ];

    const QUESTIONS = [
      // INATTENTION (13)
      { id: "Q1", dim: "inattention", text: "Je commence plusieurs tâches sans en finir aucune complètement." },
      { id: "Q2", dim: "inattention", text: "Je perds régulièrement des objets essentiels (clés, téléphone, documents)." },
      { id: "Q3", dim: "inattention", text: "Je décroche mentalement quand une tâche devient longue ou répétitive." },
      { id: "Q4", dim: "inattention", text: "J'évite ou repousse les tâches nécessitant un effort mental soutenu." },
      { id: "Q5", dim: "inattention", text: "Je fais des erreurs d'inattention en négligeant des détails importants." },
      { id: "Q6", dim: "inattention", text: "J'oublie des rendez-vous ou échéances même quand ils sont notés." },
      { id: "Q7", dim: "inattention", text: "J'ai du mal à suivre des instructions en plusieurs étapes." },
      { id: "Q8", dim: "inattention", text: "Mon esprit vagabonde pendant les conversations, même importantes." },
      { id: "Q9", dim: "inattention", text: "J'ai des dizaines de projets ou tâches en suspens non terminés." },
      { id: "Q10", dim: "inattention", text: "J'ai besoin de forte stimulation ou d'urgence pour maintenir mon attention." },
      { id: "Q11", dim: "inattention", text: "Je relis plusieurs fois la même phrase sans retenir l'information." },
      { id: "Q12", dim: "inattention", text: "En réunion ou cours, je perds le fil si le contenu n'est pas très dynamique." },
      { id: "Q13", dim: "inattention", text: "Je m'épuise mentalement beaucoup plus vite que mon entourage." },

      // HYPERACTIVITÉ (12)
      { id: "Q14", dim: "hyperactivite", text: "Je bouge constamment les mains, pieds ou change de position." },
      { id: "Q15", dim: "hyperactivite", text: "Je ressens une agitation intérieure même quand je reste physiquement immobile." },
      { id: "Q16", dim: "hyperactivite", text: "Rester assis longtemps me met profondément mal à l'aise." },
      { id: "Q17", dim: "hyperactivite", text: "Je parle rapidement et abondamment, surtout quand je suis stimulé·e." },
      { id: "Q18", dim: "hyperactivite", text: "Je fais plusieurs activités simultanées pour gérer mon niveau d'énergie." },
      { id: "Q19", dim: "hyperactivite", text: "L'activité physique m'aide significativement à me recentrer." },
      { id: "Q20", dim: "hyperactivite", text: "Je me sens mieux en mouvement qu'en situation d'attente passive." },
      { id: "Q21", dim: "hyperactivite", text: "L'ennui me devient rapidement insupportable si le rythme est lent." },
      { id: "Q22", dim: "hyperactivite", text: "Je coupe involontairement la parole par impatience ou élan spontané." },
      { id: "Q23", dim: "hyperactivite", text: "J'ai besoin de changer fréquemment d'activité pour rester engagé·e." },
      { id: "Q24", dim: "hyperactivite", text: "Mon esprit tourne en boucle sans arrêt, même la nuit." },
      { id: "Q25", dim: "hyperactivite", text: "Je planifie des journées excessivement chargées pour me sentir vivant·e." },

      // IMPULSIVITÉ (12)
      { id: "Q26", dim: "impulsivite", text: "J'agis avant d'avoir réfléchi aux conséquences possibles." },
      { id: "Q27", dim: "impulsivite", text: "Je fais régulièrement des achats impulsifs que je regrette ensuite." },
      { id: "Q28", dim: "impulsivite", text: "Je termine les phrases des autres ou réponds avant qu'on ait fini de parler." },
      { id: "Q29", dim: "impulsivite", text: "Je prends des risques inconsidérés (conduite, paris, décisions hâtives)." },
      { id: "Q30", dim: "impulsivite", text: "Attendre mon tour (file d'attente, discussion) me coûte beaucoup d'effort." },
      { id: "Q31", dim: "impulsivite", text: "Je change d'avis brutalement sous l'effet d'une émotion forte." },
      { id: "Q32", dim: "impulsivite", text: "Je m'engage dans trop de projets sans évaluer ma capacité réelle." },
      { id: "Q33", dim: "impulsivite", text: "J'envoie des messages ou emails 'à chaud' que je regrette après coup." },
      { id: "Q34", dim: "impulsivite", text: "Je révèle des informations personnelles sans filtrage suffisant." },
      { id: "Q35", dim: "impulsivite", text: "Je mange ou bois de façon compulsive sans faim ou soif réelle." },
      { id: "Q36", dim: "impulsivite", text: "Je privilégie systématiquement la gratification immédiate sur le long terme." },
      { id: "Q37", dim: "impulsivite", text: "J'alterne entre procrastination massive et sprint de dernière minute." },

      // RÉGULATION ÉMOTIONNELLE (13)
      { id: "Q38", dim: "emotion", text: "Mes émotions montent intensément et rapidement, puis retombent tout aussi vite." },
      { id: "Q39", dim: "emotion", text: "Les critiques (même mineures) me restent en tête pendant des jours." },
      { id: "Q40", dim: "emotion", text: "Je passe du rire au découragement profond en très peu de temps." },
      { id: "Q41", dim: "emotion", text: "Le stress déstabilise complètement mon organisation quotidienne." },
      { id: "Q42", dim: "emotion", text: "Je ne sais plus prioriser quand plusieurs choses semblent urgentes." },
      { id: "Q43", dim: "emotion", text: "J'oublie mes besoins de base (manger, boire, dormir) en hyperfocus." },
      { id: "Q44", dim: "emotion", text: "Je reporte des démarches simples (administratif) par surcharge cognitive." },
      { id: "Q45", dim: "emotion", text: "Je me sens 'trop intense' ou 'trop sensible' pour mon entourage." },
      { id: "Q46", dim: "emotion", text: "Les transitions (commencer ou arrêter) me demandent un effort énorme." },
      { id: "Q47", dim: "emotion", text: "Je rumine mes interactions sociales longtemps après qu'elles soient terminées." },
      { id: "Q48", dim: "emotion", text: "J'ai absolument besoin de supports visuels pour m'organiser efficacement." },
      { id: "Q49", dim: "emotion", text: "Si une tâche n'est pas visible, je l'oublie complètement." },
      { id: "Q50", dim: "emotion", text: "Mon environnement physique influence drastiquement ma productivité." },
    ];

    // ============================================================
    // FONCTIONS DE SCORING
    // ============================================================

    function scoreBands(total) {
      if (total <= 60) {
        return {
          band: "Profil attentionnel stable",
          color: "green",
          severity: "none",
          message: "Tes réponses ne révèlent pas de symptomatologie TDAH significative. Si tu ressens malgré tout des difficultés, elles peuvent être liées au stress, au sommeil, ou à des situations spécifiques.",
          recommendations: [
            "Aucune démarche spécifique TDAH nécessaire",
            "Si difficultés persistantes : consulte pour autre cause",
            "Maintiens une bonne hygiène de vie"
          ]
        };
      }
      
      if (total <= 100) {
        return {
          band: "Variabilité attentionnelle modérée",
          color: "yellow",
          severity: "low",
          message: "Tu présentes des difficultés attentionnelles légères, compatibles avec du stress, de la fatigue chronique ou des traits sub-cliniques. Un TDAH est possible mais peu probable si ces symptômes sont récents ou contextuels.",
          recommendations: [
            "Observe si les symptômes persistent en période calme",
            "Mets en place des stratégies d'organisation (to-do, rappels)",
            "Si gêne quotidienne : consultation possible pour évaluation",
            "Améliore sommeil et activité physique en priorité"
          ]
        };
      }
      
      if (total <= 135) {
        return {
          band: "Symptomatologie TDAH probable",
          color: "orange",
          severity: "moderate",
          message: "Ton profil suggère fortement une symptomatologie TDAH. Les scores révèlent des difficultés significatives dans plusieurs dimensions. Une évaluation diagnostique par un professionnel formé au TDAH adulte est recommandée.",
          recommendations: [
            "Prends rendez-vous avec un psychiatre ou neurologue spécialisé TDAH adulte",
            "Rassemble des exemples concrets de situations problématiques",
            "Si possible, demande à un proche de témoigner (enfance, quotidien)",
            "En attendant : externalise ta mémoire (post-it, alarmes, listes)",
            "Fragmente les tâches longues en mini-étapes"
          ]
        };
      }
      
      return {
        band: "Symptomatologie TDAH marquée",
        color: "red",
        severity: "high",
        message: "Ton score indique une symptomatologie TDAH sévère et envahissante. L'impact semble majeur sur ton quotidien. Une évaluation diagnostique est fortement conseillée, ainsi qu'un accompagnement rapide si le diagnostic est confirmé.",
        recommendations: [
          "Consulte en urgence un psychiatre spécialisé TDAH adulte",
          "Documente précisément tes difficultés pour la consultation",
          "Explore les ressources d'accompagnement (psychoéducation, coaching TDAH)",
          "Informe ton entourage proche pour obtenir du soutien",
          "Si diagnostic confirmé : traitement médicamenteux souvent très efficace",
          "Rejoins des communautés TDAH (TDAH France, groupes de soutien)"
        ]
      };
    }

    function getAxisAnalysis(dimScores) {
      const sorted = Object.entries(dimScores)
        .map(([key, score]) => ({ key, score, dim: DIMENSIONS.find(d => d.key === key) }))
        .sort((a, b) => b.score - a.score);
      
      const dominant = sorted[0];
      
      const analyses = {
        inattention: "L'inattention est ta dimension dominante. Tu as probablement du mal à maintenir ton attention sur des tâches longues, à filtrer les distractions, ou à gérer plusieurs informations simultanément. C'est souvent la dimension la plus handicapante au quotidien (travail, études, tâches administratives).",
        hyperactivite: "L'hyperactivité (motrice ou mentale) domine ton profil. Tu ressens peut-être une agitation intérieure constante, un besoin de bouger, ou une difficulté à rester en place. Chez l'adulte, cela se manifeste souvent par une sensation de 'moteur interne' qui ne s'arrête jamais.",
        impulsivite: "L'impulsivité est au cœur de tes difficultés. Tu agis probablement avant de réfléchir, as du mal à différer une gratification, ou prends des décisions hâtives. Cela peut impacter tes relations, tes finances, ou ta sécurité.",
        emotion: "La dysrégulation émotionnelle est ta dimension principale. Tu vis probablement tes émotions de façon très intense, avec des hauts et des bas rapides. Les critiques te touchent profondément, et tu peux ruminer longtemps après certaines situations."
      };
      
      return {
        dominant: dominant.key,
        analysis: analyses[dominant.key]
      };
    }

    // ============================================================
    // COMPOSANT PRINCIPAL
    // ============================================================

    function TDAHTestV33() {
      const [page, setPage] = useState("intro");
      const [currentQ, setCurrentQ] = useState(0);
      const [answers, setAnswers] = useState({});
      const [email, setEmail] = useState("");

      // SUPPRESSION TOTALE localStorage — Test toujours vierge
      // Plus aucune restauration automatique

      const allAnswered = Object.keys(answers).length === QUESTIONS.length;

      const handleAnswer = useCallback((qId, value) => {
        setAnswers(prev => ({ ...prev, [qId]: value }));
        
        if (currentQ < QUESTIONS.length - 1) {
          setTimeout(() => setCurrentQ(c => c + 1), 150);
        }
      }, [currentQ]);

      const goToResults = useCallback(() => {
        if (!allAnswered) {
          alert(`Il reste ${QUESTIONS.length - Object.keys(answers).length} question(s) sans réponse.`);
          return;
        }
        setPage("results");
      }, [allAnswered, answers]);

      const reset = useCallback(() => {
        setAnswers({});
        setCurrentQ(0);
        setPage("intro");
        setEmail("");
      }, []);

      const dimensionScores = useMemo(() => {
        const scores = {};
        DIMENSIONS.forEach(dim => {
          const qs = QUESTIONS.filter(q => q.dim === dim.key);
          const total = qs.reduce((sum, q) => sum + (answers[q.id] || 0), 0);
          scores[dim.key] = total;
        });
        return scores;
      }, [answers]);

      const totalScore = useMemo(() => {
        return Object.values(dimensionScores).reduce((a, b) => a + b, 0);
      }, [dimensionScores]);

      const resultBand = useMemo(() => scoreBands(totalScore), [totalScore]);
      const profileAnalysis = useMemo(() => getAxisAnalysis(dimensionScores), [dimensionScores]);

      const handlePDF = useCallback(() => {
        window.print();
      }, []);

      const handleDownloadJSON = useCallback(() => {
        const data = {
          test: "TDAH Auto-test Noesis v3.3",
          date: new Date().toISOString(),
          totalScore,
          resultBand: resultBand.band,
          dimensionScores,
          answers: QUESTIONS.map(q => ({
            id: q.id,
            dimension: q.dim,
            question: q.text,
            answer: CHOICES.find(c => c.value === answers[q.id])?.label || "Non répondu"
          }))
        };
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `noesis-tdah-test-${new Date().toISOString().split('T')[0]}.json`;
        a.click();
        URL.revokeObjectURL(url);
      }, [totalScore, resultBand, dimensionScores, answers]);

      const handleEmail = useCallback(() => {
        if (!email) return;
        const subject = encodeURIComponent("Résultats Auto-test TDAH Noesis");
        const body = encodeURIComponent(
          `Bonjour,\n\nVoici mes résultats au test TDAH Noesis :\n\n` +
          `Score total : ${totalScore}/200\n` +
          `Profil : ${resultBand.band}\n\n` +
          `Scores par dimension :\n` +
          DIMENSIONS.map(d => `- ${d.label} : ${dimensionScores[d.key]}`).join('\n') +
          `\n\nPour consulter le détail complet, merci de télécharger le PDF ou JSON depuis le site.`
        );
        window.location.href = `mailto:${email}?subject=${subject}&body=${body}`;
      }, [email, totalScore, resultBand, dimensionScores]);

      const progress = useMemo(() => Math.round((currentQ / QUESTIONS.length) * 100), [currentQ]);

      // ============================================================
      // PAGE INTRO
      // ============================================================
      
      if (page === "intro") {
        return (
          <div className="min-h-screen bg-gradient-to-br from-slate-50 via-indigo-50 to-purple-50 p-4 md:p-8">
            <div className="max-w-3xl mx-auto">
              <div className="text-center mb-8">
                <div className="inline-block p-4 bg-indigo-100 rounded-2xl mb-4">
                  <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="text-indigo-600">
                    <path d="M9.5 2c-1.82 0-3.53.5-5 1.36C2.68 4.72 1.5 6.73 1.5 9c0 1.56.52 3 1.39 4.14.87 1.14 2.07 2 3.43 2.36"/>
                    <path d="M14.5 2c1.82 0 3.53.5 5 1.36C21.32 4.72 22.5 6.73 22.5 9c0 1.56-.52 3-1.39 4.14-.87 1.14-2.07 2-3.43 2.36"/>
                    <path d="M12 2v20"/>
                    <path d="M9.5 15.5c0 1.38.62 2.5 1.5 2.5"/>
                    <path d="M14.5 15.5c0 1.38-.62 2.5-1.5 2.5"/>
                    <circle cx="9" cy="9" r="1" fill="currentColor"/>
                    <circle cx="15" cy="9" r="1" fill="currentColor"/>
                  </svg>
                </div>
                <h1 className="text-4xl md:text-5xl font-black text-slate-900 mb-3">
                  Auto-test TDAH Adulte
                </h1>
                <p className="text-lg text-slate-600 font-medium">
                  Outil de pré-diagnostic orienté clinique
                </p>
              </div>

              <div className="bg-white rounded-2xl shadow-2xl p-6 md:p-8 mb-6">
                <div className="bg-amber-50 border-l-4 border-amber-500 p-4 mb-6 rounded-r-lg">
                  <div className="flex gap-3">
                    <span className="text-2xl flex-shrink-0">⚠️</span>
                    <div className="text-sm text-amber-900">
                      <p className="font-bold mb-1">Avertissement méthodologique</p>
                      <p className="leading-relaxed">
                        Cet auto-test <strong>ne remplace pas un diagnostic médical</strong>. 
                        Il constitue un outil d'orientation basé sur les critères DSM-5 et l'échelle ASRS. 
                        Seul un professionnel de santé formé peut poser un diagnostic de TDAH.
                      </p>
                    </div>
                  </div>
                </div>

                <div className="mb-8">
                  <h2 className="text-xl font-bold text-slate-900 mb-4">📊 Méthodologie</h2>
                  <div className="grid grid-cols-2 md:grid-cols-4 gap-3 mb-6">
                    <div className="bg-amber-50 text-amber-700 px-3 py-2 rounded-lg text-center text-sm font-semibold">
                      DSM-5
                    </div>
                    <div className="bg-sky-50 text-sky-700 px-3 py-2 rounded-lg text-center text-sm font-semibold">
                      ASRS v1.1
                    </div>
                    <div className="bg-rose-50 text-rose-700 px-3 py-2 rounded-lg text-center text-sm font-semibold">
                      4 axes
                    </div>
                    <div className="bg-emerald-50 text-emerald-700 px-3 py-2 rounded-lg text-center text-sm font-semibold">
                      50 items
                    </div>
                  </div>

                  <div className="prose prose-sm text-slate-700 space-y-3">
                    <p className="leading-relaxed">
                      Ce test évalue <strong>quatre dimensions clés</strong> du TDAH adulte : 
                      l'inattention, l'hyperactivité, l'impulsivité et la dysrégulation émotionnelle. 
                      Chaque question explore des manifestations concrètes du quotidien.
                    </p>
                    <p className="leading-relaxed">
                      Les <strong>seuils de scoring</strong> sont calibrés sur la littérature clinique 
                      et permettent de situer ton profil sur un continuum allant de "stable" à "symptomatologie marquée".
                    </p>
                  </div>
                </div>

                <div className="grid md:grid-cols-3 gap-4 mb-8">
                  <div className="bg-slate-50 p-4 rounded-xl text-center">
                    <div className="flex justify-center mb-2">
                      <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="text-indigo-600">
                        <circle cx="12" cy="13" r="9"/>
                        <polyline points="12 7 12 13 15 15"/>
                        <path d="M10 2h4"/>
                      </svg>
                    </div>
                    <div className="text-2xl font-bold text-slate-900">10-15 min</div>
                    <div className="text-sm text-slate-600">Durée estimée</div>
                  </div>
                  <div className="bg-slate-50 p-4 rounded-xl text-center">
                    <div className="flex justify-center mb-2">
                      <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="text-indigo-600">
                        <line x1="18" y1="20" x2="18" y2="10"/>
                        <line x1="12" y1="20" x2="12" y2="4"/>
                        <line x1="6" y1="20" x2="6" y2="14"/>
                      </svg>
                    </div>
                    <div className="text-2xl font-bold text-slate-900">50 questions</div>
                    <div className="text-sm text-slate-600">Questionnaire complet</div>
                  </div>
                  <div className="bg-slate-50 p-4 rounded-xl text-center">
                    <div className="flex justify-center mb-2">
                      <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="text-indigo-600">
                        <path d="M3 3v18h18"/>
                        <path d="M18 9l-5 5-4-4-4 4"/>
                        <circle cx="18" cy="9" r="2" fill="currentColor"/>
                        <circle cx="13" cy="14" r="2" fill="currentColor"/>
                        <circle cx="9" cy="10" r="2" fill="currentColor"/>
                        <circle cx="5" cy="14" r="2" fill="currentColor"/>
                      </svg>
                    </div>
                    <div className="text-2xl font-bold text-slate-900">4 dimensions</div>
                    <div className="text-sm text-slate-600">Analyse multi-axes</div>
                  </div>
                </div>

                <button
                  onClick={() => setPage("test")}
                  className="w-full bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white text-lg font-bold py-4 px-6 rounded-xl transition-all shadow-lg hover:shadow-xl"
                >
                  Commencer le test →
                </button>
              </div>

              <div className="text-center text-xs text-slate-500 space-y-1">
                <p className="font-semibold">Noesis — Auto-test TDAH v3.3 • © 2025</p>
                <p>Confidentialité : aucune donnée collectée sans action explicite (RGPD)</p>
              </div>
            </div>
          </div>
        );
      }

      // ============================================================
      // PAGE TEST
      // ============================================================

      if (page === "test") {
        const q = QUESTIONS[currentQ];
        const dimInfo = DIMENSIONS.find(d => d.key === q.dim);
        const colorMap = {
          amber: { bg: "bg-amber-50", border: "border-amber-300", text: "text-amber-700", badge: "bg-amber-100 text-amber-700" },
          sky: { bg: "bg-sky-50", border: "border-sky-300", text: "text-sky-700", badge: "bg-sky-100 text-sky-700" },
          rose: { bg: "bg-rose-50", border: "border-rose-300", text: "text-rose-700", badge: "bg-rose-100 text-rose-700" },
          emerald: { bg: "bg-emerald-50", border: "border-emerald-300", text: "text-emerald-700", badge: "bg-emerald-100 text-emerald-700" },
        };
        const colors = colorMap[dimInfo.color];

        return (
          <div className="min-h-screen bg-gradient-to-br from-slate-50 via-indigo-50 to-purple-50 p-4 md:p-8">
            <div className="max-w-3xl mx-auto">
              
              <div className="mb-6">
                <div className="flex justify-between items-center mb-2">
                  <span className="text-sm font-medium text-slate-600">
                    Question {currentQ + 1} / {QUESTIONS.length}
                  </span>
                  <span className="text-sm font-bold text-indigo-600">{progress}%</span>
                </div>
                <div className="w-full bg-slate-200 rounded-full h-3 overflow-hidden">
                  <div 
                    className="h-full bg-gradient-to-r from-indigo-500 to-purple-500 transition-all duration-300"
                    style={{ width: `${progress}%` }}
                  />
                </div>
              </div>

              <div className="bg-white rounded-2xl shadow-2xl p-6 md:p-8 mb-6">
                <div className="flex items-center gap-3 mb-6">
                  <div className={`w-12 h-12 rounded-full ${colors.bg} ${colors.border} border-2 flex items-center justify-center font-bold ${colors.text} text-lg`}>
                    {currentQ + 1}
                  </div>
                  <span className={`px-3 py-1 rounded-full text-xs font-semibold ${colors.badge}`}>
                    {dimInfo.label}
                  </span>
                </div>

                <h2 className="text-xl md:text-2xl font-bold text-slate-900 mb-8 leading-relaxed">
                  {q.text}
                </h2>

                <div className="space-y-3">
                  {CHOICES.map(choice => {
                    const isSelected = answers[q.id] === choice.value;
                    return (
                      <button
                        key={choice.value}
                        onClick={() => handleAnswer(q.id, choice.value)}
                        className={`w-full text-left p-4 rounded-xl border-2 transition-all ${
                          isSelected
                            ? 'bg-indigo-50 border-indigo-500 shadow-lg'
                            : 'bg-white border-slate-200 hover:border-indigo-300 hover:bg-slate-50'
                        }`}
                      >
                        <div className="flex items-center justify-between">
                          <div>
                            <div className={`font-semibold mb-1 ${isSelected ? 'text-indigo-700' : 'text-slate-900'}`}>
                              {choice.label}
                            </div>
                            <div className="text-xs text-slate-500">{choice.anchor}</div>
                          </div>
                          <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center ${
                            isSelected ? 'bg-indigo-500 border-indigo-500' : 'border-slate-300'
                          }`}>
                            {isSelected && <span className="text-white text-xs font-bold">✓</span>}
                          </div>
                        </div>
                      </button>
                    );
                  })}
                </div>
              </div>

              <div className="flex gap-4">
                <button
                  onClick={() => setCurrentQ(c => Math.max(0, c - 1))}
                  disabled={currentQ === 0}
                  className="flex-1 bg-slate-200 hover:bg-slate-300 disabled:bg-slate-100 disabled:text-slate-400 text-slate-700 font-semibold py-3 px-6 rounded-xl transition"
                >
                  ← Précédent
                </button>
                
                {currentQ === QUESTIONS.length - 1 ? (
                  <button
                    onClick={goToResults}
                    disabled={!allAnswered}
                    className="flex-1 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 disabled:from-slate-300 disabled:to-slate-300 text-white font-bold py-3 px-6 rounded-xl transition-all shadow-lg"
                  >
                    Voir les résultats →
                  </button>
                ) : (
                  <button
                    onClick={() => setCurrentQ(c => Math.min(QUESTIONS.length - 1, c + 1))}
                    className="flex-1 bg-slate-700 hover:bg-slate-800 text-white font-semibold py-3 px-6 rounded-xl transition"
                  >
                    Suivant →
                  </button>
                )}
              </div>

              <div className="mt-4 text-center">
                <button
                  onClick={goToResults}
                  disabled={!allAnswered}
                  className="text-sm text-slate-500 hover:text-slate-700 underline disabled:text-slate-300"
                >
                  {allAnswered ? "Aller directement aux résultats" : `${QUESTIONS.length - Object.keys(answers).length} question(s) restante(s)`}
                </button>
              </div>
            </div>
          </div>
        );
      }

      // ============================================================
      // PAGE RÉSULTATS + SECTION IMPRIMABLE
      // ============================================================

      return (
        <div className="min-h-screen bg-gradient-to-br from-slate-50 via-indigo-50 to-purple-50 p-4 md:p-8">
          <div className="max-w-5xl mx-auto">
            
            {/* SECTION ÉCRAN */}
            <div className="no-print">
              <div className="text-center mb-8">
                <div className="inline-block p-4 bg-gradient-to-br from-indigo-100 to-purple-100 rounded-2xl mb-4">
                  <svg width="56" height="56" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="text-indigo-600">
                    <path d="M3 3v18h18"/>
                    <path d="M18 9l-5 5-4-4-4 4"/>
                    <circle cx="18" cy="9" r="2"/>
                    <circle cx="13" cy="14" r="2"/>
                    <circle cx="9" cy="10" r="2"/>
                    <circle cx="5" cy="14" r="2"/>
                  </svg>
                </div>
                <h1 className="text-4xl md:text-5xl font-black text-slate-900 mb-3">
                  Tes résultats
                </h1>
                <p className="text-lg text-slate-600 font-medium">
                  Analyse détaillée de ton profil TDAH
                </p>
              </div>

              <div className="bg-white rounded-2xl shadow-2xl p-6 md:p-8 mb-6">
                <div className="text-center mb-6">
                  <div className="text-6xl font-black text-slate-900 mb-2">
                    {totalScore}<span className="text-3xl text-slate-400">/200</span>
                  </div>
                  <div className={`inline-block px-6 py-2 rounded-full text-lg font-bold ${
                    resultBand.color === 'green' ? 'bg-green-100 text-green-700' :
                    resultBand.color === 'yellow' ? 'bg-yellow-100 text-yellow-700' :
                    resultBand.color === 'orange' ? 'bg-orange-100 text-orange-700' :
                    'bg-red-100 text-red-700'
                  }`}>
                    {resultBand.band}
                  </div>
                </div>

                <div className="bg-slate-50 p-6 rounded-2xl mb-6">
                  <h3 className="font-bold text-slate-900 mb-3">🔍 Interprétation clinique</h3>
                  <p className="text-sm text-slate-700 leading-relaxed">
                    {resultBand.message}
                  </p>
                </div>

                <div className="space-y-4 mb-6">
                  <h3 className="font-bold text-slate-900">Scores par dimension</h3>
                  {DIMENSIONS.map(dim => {
                    const score = dimensionScores[dim.key];
                    const max = QUESTIONS.filter(q => q.dim === dim.key).length * 4;
                    const percentage = Math.round((score / max) * 100);
                    const colorMap = {
                      amber: { bg: "bg-amber-50", bar: "bg-amber-500", text: "text-amber-700" },
                      sky: { bg: "bg-sky-50", bar: "bg-sky-500", text: "text-sky-700" },
                      rose: { bg: "bg-rose-50", bar: "bg-rose-500", text: "text-rose-700" },
                      emerald: { bg: "bg-emerald-50", bar: "bg-emerald-500", text: "text-emerald-700" },
                    };
                    const colors = colorMap[dim.color];
                    
                    return (
                      <div key={dim.key} className={`p-4 rounded-xl ${colors.bg}`}>
                        <div className="flex justify-between items-center mb-2">
                          <span className={`text-sm font-bold ${colors.text}`}>{dim.label}</span>
                          <span className="text-sm font-bold text-slate-700">{score}/{max}</span>
                        </div>
                        <div className="w-full bg-white rounded-full h-3 overflow-hidden">
                          <div 
                            className={`h-full ${colors.bar} transition-all duration-500`}
                            style={{ width: `${percentage}%` }}
                          />
                        </div>
                        <div className="text-xs text-slate-600 mt-1">{percentage}%</div>
                      </div>
                    );
                  })}
                </div>

                <div className="bg-slate-50 p-6 rounded-2xl">
                  <h3 className="font-bold text-slate-900 mb-3">📌 Ton profil dominant</h3>
                  <p className="text-sm font-semibold text-indigo-600 mb-2">
                    {DIMENSIONS.find(d => d.key === profileAnalysis.dominant)?.label}
                  </p>
                  <p className="text-sm text-slate-700 leading-relaxed">
                    {profileAnalysis.analysis}
                  </p>
                </div>
              </div>

              <div className="grid md:grid-cols-2 gap-6">
                
                <div className="bg-white rounded-2xl shadow-xl p-6">
                  <h2 className="text-xl font-bold text-slate-900 mb-4">Recommandations</h2>
                  <ul className="space-y-3">
                    {resultBand.recommendations.map((rec, idx) => (
                      <li key={idx} className="flex gap-3 text-sm text-slate-700">
                        <span className="flex-shrink-0 w-6 h-6 rounded-full bg-indigo-100 text-indigo-600 font-bold text-xs flex items-center justify-center">
                          {idx + 1}
                        </span>
                        <span>{rec}</span>
                      </li>
                    ))}
                  </ul>

                  <div className="mt-6 pt-6 border-t-2 border-slate-100">
                    <h3 className="font-bold text-slate-900 mb-3">Ressources utiles</h3>
                    <ul className="space-y-2 text-sm">
                      <li>
                        <a href="https://www.tdah-france.fr" target="_blank" rel="noopener noreferrer" className="text-indigo-600 hover:text-indigo-800 font-medium underline">
                          TDAH France
                        </a>
                        <span className="text-slate-600"> — Association & annuaire</span>
                      </li>
                      <li>
                        <a href="https://www.doctolib.fr" target="_blank" rel="noopener noreferrer" className="text-indigo-600 hover:text-indigo-800 font-medium underline">
                          Doctolib
                        </a>
                        <span className="text-slate-600"> — Recherche "TDAH adulte"</span>
                      </li>
                    </ul>
                  </div>
                </div>

                <div className="bg-white rounded-2xl shadow-xl p-6">
                  <h2 className="text-xl font-bold text-slate-900 mb-4">Exporter les résultats</h2>
                  
                  <div className="space-y-3">
                    <button
                      onClick={handlePDF}
                      className="w-full bg-slate-900 text-white font-semibold py-3 px-4 rounded-xl hover:bg-slate-800 transition"
                    >
                      📄 Télécharger en PDF
                    </button>

                    <button
                      onClick={handleDownloadJSON}
                      className="w-full bg-slate-700 text-white font-semibold py-3 px-4 rounded-xl hover:bg-slate-600 transition"
                    >
                      💾 Télécharger en JSON
                    </button>

                    <div className="pt-4 border-t-2 border-slate-100">
                      <label className="block text-sm font-medium text-slate-700 mb-2">
                        Envoyer par email
                      </label>
                      <div className="flex gap-2">
                        <input
                          type="email"
                          value={email}
                          onChange={(e) => setEmail(e.target.value)}
                          placeholder="email@exemple.com"
                          className="flex-1 rounded-lg border-2 border-slate-300 px-3 py-2 text-sm focus:border-indigo-500 focus:outline-none"
                        />
                        <button
                          onClick={handleEmail}
                          disabled={!email}
                          className="bg-indigo-600 disabled:bg-slate-300 text-white font-semibold px-4 py-2 rounded-lg hover:bg-indigo-700 transition"
                        >
                          📧
                        </button>
                      </div>
                    </div>

                    <button
                      onClick={reset}
                      className="w-full mt-4 text-slate-600 hover:text-slate-900 font-medium underline text-sm"
                    >
                      Refaire le test
                    </button>
                  </div>
                </div>
              </div>

              <div className="mt-8 text-center text-xs text-slate-500 space-y-2">
                <p className="font-semibold">Noesis — Auto-test TDAH v3.3 • © 2025</p>
                <p>Outil de pré-diagnostic d'orientation • Pas un diagnostic médical</p>
                <p>Confidentialité : aucune donnée collectée sans action explicite (RGPD)</p>
              </div>
            </div>

            {/* SECTION IMPRIMABLE PDF (cachée à l'écran) */}
            <div className="print-only print-container">
              <div className="print-section">
                <h1 className="print-header">Résultats Auto-test TDAH — Noesis</h1>
                <p className="print-text">Date : {new Date().toLocaleDateString('fr-FR')}</p>
                <p className="print-text">Score total : <strong>{totalScore}/200</strong></p>
                <p className="print-text">Profil : <strong>{resultBand.band}</strong></p>
              </div>

              <div className="print-section">
                <h2 className="print-subheader">Interprétation clinique</h2>
                <p className="print-text">{resultBand.message}</p>
              </div>

              <div className="print-section">
                <h2 className="print-subheader">Scores par dimension</h2>
                {DIMENSIONS.map(dim => {
                  const score = dimensionScores[dim.key];
                  const max = QUESTIONS.filter(q => q.dim === dim.key).length * 4;
                  const percentage = Math.round((score / max) * 100);
                  return (
                    <div key={dim.key} className="print-score-box">
                      <p className="print-text"><strong>{dim.label}</strong> : {score}/{max} ({percentage}%)</p>
                    </div>
                  );
                })}
              </div>

              <div className="print-section">
                <h2 className="print-subheader">Profil dominant</h2>
                <p className="print-text"><strong>{DIMENSIONS.find(d => d.key === profileAnalysis.dominant)?.label}</strong></p>
                <p className="print-text">{profileAnalysis.analysis}</p>
              </div>

              <div className="print-section">
                <h2 className="print-subheader">Recommandations</h2>
                {resultBand.recommendations.map((rec, idx) => (
                  <p key={idx} className="print-reco">{idx + 1}. {rec}</p>
                ))}
              </div>

              {/* DÉTAIL COMPLET DES QUESTIONS PAR AXE */}
              <div className="print-section" style={{pageBreakBefore: 'always'}}>
                <h2 className="print-header">Détail des réponses par dimension</h2>
                
                {DIMENSIONS.map(dim => {
                  const dimQuestions = QUESTIONS.filter(q => q.dim === dim.key);
                  return (
                    <div key={dim.key} className="print-axis-section">
                      <h3 className="print-subheader">{dim.label}</h3>
                      {dimQuestions.map(q => {
                        const answer = CHOICES.find(c => c.value === answers[q.id]);
                        return (
                          <div key={q.id} className="print-question">
                            <p className="print-text">
                              <strong>{q.id}</strong> : {q.text}
                            </p>
                            <p className="print-text" style={{paddingLeft: '16px', color: '#4b5563'}}>
                              → Réponse : <strong>{answer?.label || 'Non répondu'}</strong> ({answer?.anchor || ''})
                            </p>
                          </div>
                        );
                      })}
                    </div>
                  );
                })}
              </div>

              <div className="print-section" style={{marginTop: '20px', paddingTop: '12px', borderTop: '1px solid #e2e8f0'}}>
                <p className="print-text" style={{fontSize: '10px', color: '#64748b'}}>
                  Noesis — Auto-test TDAH v3.3 • © 2025 • Outil de pré-diagnostic d'orientation, ne remplace pas un diagnostic médical
                </p>
              </div>
            </div>
          </div>
        </div>
      );
    }

    // ============================================================
    // RENDU DANS LE DOM
    // ============================================================

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<TDAHTestV33 />);
  </script>
</body>
</html>
